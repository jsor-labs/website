<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>HTTP: 
Http - ReactPHP</title>

        <meta name="description" content="Event-driven, streaming plaintext HTTP and secure HTTPS server for ReactPHP.">

        <link rel="apple-touch-icon" sizes="180x180" href="https://jsor-labs.github.io/website/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://jsor-labs.github.io/website/favicon-32x32.png">
        <link rel="manifest" href="https://jsor-labs.github.io/website/manifest.json">
        <link rel="mask-icon" href="https://jsor-labs.github.io/website/safari-pinned-tab.svg" color="#4f5b93">
        <meta name="apple-mobile-web-app-title" content="ReactPHP">
        <meta name="application-name" content="ReactPHP">
        <meta name="theme-color" content="#f4f3f1">
        <meta name="msapplication-config" content="https://jsor-labs.github.io/website/browserconfig.xml" />

        <meta property="og:image" content="https://jsor-labs.github.io/website/og-image.png">

            <link rel="preload" href="../assets/" as="font" type="font/woff" crossorigin>
        <link rel="preload" href="../assets/" as="font" type="font/woff" crossorigin>

        <script>window.__assets = '../assets/';</script>
        <script>!function(e){function t(t){for(var n,o,i=t[0],c=t[1],l=t[2],f=0,d=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(s&&s(t);d.length;)d.shift()();return u.push.apply(u,l||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(u.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={1:0},a={1:0},u=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[];o[e]?t.push(o[e]):0!==o[e]&&{3:1,4:1,5:1}[e]&&t.push(o[e]=new Promise((function(t,r){for(var n=({}[e]||e)+"."+{2:"31d6cfe0",3:"53486f42",4:"6cbb74cd",5:"38ec425d"}[e]+".css",a=i.p+n,u=document.getElementsByTagName("link"),c=0;c<u.length;c++){var l=(s=u[c]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(l===n||l===a))return t()}var f=document.getElementsByTagName("style");for(c=0;c<f.length;c++){var s;if((l=(s=f[c]).getAttribute("data-href"))===n||l===a)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var n=t&&t.target&&t.target.src||a,u=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");u.code="CSS_CHUNK_LOAD_FAILED",u.request=n,delete o[e],d.parentNode.removeChild(d),r(u)},d.href=a,document.getElementsByTagName("head")[0].appendChild(d)})).then((function(){o[e]=0})));var r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var u,c=document.createElement("script");c.charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.src=function(e){return i.p+""+({}[e]||e)+"."+{2:"0f8f4948",3:"ca2827c9",4:"7d534a7e",5:"99f8f23a"}[e]+".js"}(e);var l=new Error;u=function(t){c.onerror=c.onload=null,clearTimeout(f);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,r[1](l)}a[e]=void 0}};var f=setTimeout((function(){u({type:"timeout",target:c})}),12e4);c.onerror=c.onload=u,document.head.appendChild(c)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i.oe=function(e){throw console.error(e),e};var c=window.webpackJsonp=window.webpackJsonp||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var f=0;f<c.length;f++)t(c[f]);var s=l;r()}([]);</script>
        <style>@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;font-display:swap;src:local("Source Sans Pro Regular"),local("SourceSansPro-Regular"),url(../assets/sourcesanspro-regular.19ca4d35.woff) format("woff")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:700;font-display:swap;src:local("Source Sans Pro Bold"),local("SourceSansPro-Bold"),url(../assets/sourcesanspro-bold.be4ba3dd.woff) format("woff")}@font-face{font-family:icons;src:url(../assets/icons.063d0ba7.ttf) format("truetype"),url(../assets/icons.5ea4cc5c.woff) format("woff"),url(../assets/icons.d59afb7d.svg#icons) format("svg");font-weight:400;font-style:normal}[class*=" icon-"],[class^=icon-]{font-family:icons!important;speak:none;font-style:normal;font-weight:400;-webkit-font-feature-settings:normal;font-feature-settings:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-hash:before{content:"\e900"}.icon-twitter:before{content:"\e901"}.icon-github:before{content:"\e902"}.icon-blog:before{content:"\e905"}.icon-earth:before{content:"\e903"}.icon-link:before{content:"\e906"}.icon-youtube:before{content:"\e904"}.icon-book:before{content:"\f007"}.icon-calendar:before{content:"\f068"}.icon-chevron-down:before{content:"\f0a3"}.icon-chevron-up:before{content:"\f0a2"}.icon-law:before{content:"\f0d8"}.icon-search:before{content:"\f02e"}.icon-x:before{content:"\f081"}.icon-feed:before{content:"\ea9b"}[class*=" icon-"],[class^=icon-]{vertical-align:-8%}html{-webkit-box-sizing:border-box;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.6}@media (max-width:768px){html{font-size:18px}}*,:after,:before{-webkit-box-sizing:inherit;box-sizing:inherit}body{margin:0;color:#584b4f;background-color:#fff}a{color:#4f5b93}a:hover{color:#a2aacd;text-decoration:underline}blockquote{padding:16px 16px 16px 24px;border-left:4px solid #4f5b93;border-radius:4px;background-color:#f4f3f1;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);position:relative;font-size:14px;font-size:.875rem}blockquote:before{content:"i";position:absolute;top:12px;left:-14px;display:block;width:24px;height:24px;background:#4f5b93;font-size:12px;padding:0 4px;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;font-weight:700;color:#fff;line-height:24px;border-radius:50%}blockquote :last-child{margin-bottom:0}blockquote,fieldset,form,h1,h2,h3,h4,h5,h6,hr,ol,p,ul{margin:0 0 16px}ul ul{margin-bottom:0}hr{clear:both;height:0;border:0;border-bottom:1px dashed #eae8e3;padding:0}h1,h2,h3,h4,h5,h6{line-height:1;-webkit-font-smoothing:antialiased;color:#584b4f;font-family:Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-weight:700}h1 a,h1 a:hover,h2 a,h2 a:hover,h3 a,h3 a:hover,h4 a,h4 a:hover,h5 a,h5 a:hover,h6 a,h6 a:hover{text-decoration:none}h1{font-size:40px;font-size:2.5rem;margin-bottom:32px;letter-spacing:-1px}h1,h1 a,h1 a:hover{color:#4f5b93}h1:not(:first-child){margin-top:32px}h2{font-size:32px;font-size:2rem;margin-bottom:32px}h2,h2 a,h2 a:hover{color:#4f5b93}h2:not(:first-child){margin-top:32px}h3{font-size:24px;font-size:1.5rem;margin-bottom:24px}h3,h3 a,h3 a:hover{color:#584b4f}h3:not(:first-child){margin-top:24px}h4{font-size:20px;font-size:1.25rem}h4,h4 a,h4 a:hover{color:#4f5b93}h4:not(:first-child){margin-top:24px}@media (max-width:768px){h1{font-size:2rem}h2{font-size:1.75rem;margin-bottom:32px}}.container{padding:32px}@media (max-width:768px){.container{padding:16px}}.wrapper{max-width:1600px;margin:auto}.wrapper--medium{max-width:1280px}.wrapper--small{max-width:960px;margin:auto}.wrapper--narrow{max-width:640px}.main{width:calc(98% - 400px)}.main,.sidebar{margin-bottom:32px}.sidebar{width:calc(400px - 2%)}@media (max-width:1024px){.main,.sidebar{width:auto;margin-top:16px}}.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}.grid{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:102%;margin-left:-2%}.grid>*{margin-left:2%;max-width:100%}.grid--4cols>*{-ms-flex-preferred-size:23%;flex-basis:23%}.grid--3cols>*{-ms-flex-preferred-size:31.33%;flex-basis:31.33%}.grid--2cols>*{-ms-flex-preferred-size:48%;flex-basis:48%}@media (max-width:768px){.grid{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.grid,.grid>*{width:100%;margin-left:0}.grid>*{-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}}.center{text-align:center}.center h1,.center h2,.center h3,.center h4,.center h5,.center h6,.hamburger{display:inline-block}.hamburger{padding:14px 12px;height:48px;cursor:pointer;font:inherit;color:inherit;text-transform:none;background-color:transparent;border:0;margin:0;overflow:visible;outline:none}.hamburger__box{width:24px;height:16px;display:inline-block;position:relative}.hamburger__inner{display:block;top:50%;margin-top:-2px}.hamburger__inner,.hamburger__inner:after,.hamburger__inner:before{width:24px;height:3px;background-color:#584b4f;border-radius:2px;position:absolute;-webkit-transition-property:-webkit-transform;transition-property:-webkit-transform;-o-transition-property:transform;transition-property:transform;transition-property:transform,-webkit-transform;-webkit-transition-duration:.15s;-o-transition-duration:.15s;transition-duration:.15s;-webkit-transition-timing-function:ease;-o-transition-timing-function:ease;transition-timing-function:ease}.hamburger__inner:after,.hamburger__inner:before{content:"";display:block}.hamburger__inner:before{top:-6px}.hamburger__inner:after{bottom:-6px}.header{width:100%;background:#fefefe;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.08);box-shadow:0 1px 0 0 rgba(0,0,0,.08);padding:0 32px}@media (max-width:768px){.header{padding:0 16px}}.header__container{width:100%;position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.header__logo{display:block;line-height:1;padding:16px 0}.header__logo svg{display:block;width:120px;height:18px}.header__search{margin:0;position:absolute;right:48px;top:7px;z-index:799}.header__search input{width:400px}@media (max-width:768px){.header__search input{width:calc(100vw - 94px)}}.header__menu{position:absolute;right:-12px;top:0;z-index:800}.footer{background:#584b4f;padding:32px;text-align:center;text-shadow:1px 1px 0 rgba(0,0,0,.125)}.footer .links a{color:#eae8e3;text-decoration:none}.footer .links a:hover{color:#9ad8bb;text-decoration:none}.iframe{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;width:100%}.iframe iframe{position:absolute;top:0;left:0;width:100%;height:100%}.links{margin:0;padding:0}.links li{display:inline-block;margin:0 8px;text-decoration:none}.links li:first-child{margin-left:0}.links li:last-child{margin-right:0}.links a{display:block}.box,.links a,.links a:hover{text-decoration:none}.box{background:#f4f3f1;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);border-radius:4px;text-align:left;vertical-align:top;padding:24px;margin-top:0;margin-bottom:24px;color:inherit;overflow:auto;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.box:hover{background:#eae8e3;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.15);box-shadow:0 1px 0 0 rgba(0,0,0,.15);text-decoration:none}.box h1,.box h2,.box h3,.box h4,.box h5,.box h6,.box hr,.box ol,.box p,.box ul{margin-bottom:8px}.box h1,.box h2,.box h3,.box h4,.box h5,.box h6{color:#584b4f}.box :first-child{margin-top:0}.box :last-child{margin-bottom:0}.box__content{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;color:#584b4f;text-decoration:none}.box__content p{font-size:14px;font-size:.875rem}.box__content:hover{color:#584b4f;text-decoration:none}.box__content:not(:last-child){margin-bottom:16px}.box__link{display:block;font-size:12px;font-size:.75rem;text-decoration:none}.box__link,.box__link [class*=icon]{color:#4f5b93}.box__link:hover{color:#a2aacd;text-decoration:none}code,pre,tt{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}code,tt{font-size:12px;font-size:.75rem;padding:.3rem .45rem;margin:0;background-color:rgba(0,0,0,.05);border-radius:4px}code br,tt br{display:none}del code{text-decoration:inherit}pre{word-wrap:normal;text-align:left;font-size:14px;font-size:.875rem;line-height:1.45}@media (max-width:768px){pre{font-size:.75rem}}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.highlight{margin-bottom:16px}.highlight pre{margin-bottom:0;word-break:normal}.highlight pre,pre{padding:16px 16px 14px;overflow:auto;background-color:#f9f9f8;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.08);box-shadow:0 1px 0 0 rgba(0,0,0,.08);color:#584b4f;text-shadow:none!important;border-radius:4px}pre code,pre tt{display:inline;max-width:none;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code:after,pre code:before,pre tt:after,pre tt:before{content:normal}.pl-c{color:#969896}.pl-c1,.pl-s .pl-v{color:#0086b3}.pl-e,.pl-en{color:#795da3}.pl-s .pl-s1,.pl-smi{color:#444}.pl-ent{color:#63a35c}.pl-k{color:#a71d5d}.pl-pds,.pl-s,.pl-s .pl-pse .pl-s1,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre{color:#183691}.pl-smw,.pl-v{color:#ed6a43}.pl-bu{color:#b52a1d}.pl-c2,.pl-ii{color:#f8f8f8;background-color:#b52a1d}.pl-c2:before{content:"^M"}.pl-sr .pl-cce{font-weight:700;color:#63a35c}.pl-ml{color:#693a17}.pl-mh,.pl-mh .pl-en,.pl-ms{font-weight:700;color:#1d3e81}.pl-mq{color:teal}.pl-mi{font-style:italic;color:#333}.pl-mb{font-weight:700;color:#333}.pl-md{color:#bd2c00;background-color:#ffecec}.pl-mi1{color:#55a532;background-color:#eaffea}.pl-mc{color:#ef9700;background-color:#ffe3b4}.pl-mi2{color:#d8d8d8;background-color:grey}.pl-mdr{font-weight:700;color:#795da3}.pl-mo{color:#1d3e81}.pl-ba{color:#595e62}.pl-sg{color:silver}.pl-corl{text-decoration:underline;color:#183691}.anchor{display:block;float:left;position:absolute;padding-right:2px;-webkit-transform:translateX(-100%);transform:translateX(-100%);text-decoration:none!important}.anchor:focus{outline:none}.anchor>*{visibility:hidden}:hover>.anchor>*{visibility:visible}.anchor>:before{content:"#";font-weight:400!important;color:#a2aacd}.anchor--disable .anchor>*,.anchor.anchor--disable>*{visibility:hidden!important}.searchbox{width:100%}.searchbox,.searchbox:focus{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:6px 8px 6px 32px;font-size:14px;font-size:.875rem;line-height:24px;color:#584b4f;border:0;background:#eae8e3 url(../assets/search.72dc4739.svg) no-repeat 10px;background-size:16px 16px;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.15);box-shadow:0 1px 0 0 rgba(0,0,0,.15);border-radius:4px;outline:none;-webkit-transition:width .35s cubic-bezier(.23,1,.32,1);-o-transition:width .35s cubic-bezier(.23,1,.32,1);transition:width .35s cubic-bezier(.23,1,.32,1)}.searchbox::-webkit-input-placeholder{color:#afa1a5}.searchbox:-moz-placeholder{color:#afa1a5}.searchbox::-moz-placeholder{color:#afa1a5;opacity:1}.searchbox:-ms-input-placeholder{color:#afa1a5}.searchbox:focus{background-color:#f4f3f1!important;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1)}.searchbox--collapsed:not(:focus){background-color:transparent;border:0;width:32px!important;margin-right:-12px;cursor:pointer;-webkit-box-shadow:none;box-shadow:none}.searchbox--collapsed:not(:focus)::-webkit-search-cancel-button,.searchbox--collapsed:not(:focus)::-webkit-search-decoration{display:none}.searchbox--collapsed:not(:focus)::-webkit-search-results-button,.searchbox--collapsed:not(:focus)::-webkit-search-results-decoration{display:none}.searchbox--collapsed:not(:focus)::-ms-clear{display:none}.searchbox--large,.searchbox--large:focus{padding:8px 12px 8px 40px}.alert{padding:16px 16px 16px 24px;border-left:4px solid #ba3525;border-radius:4px;background-color:#f4f3f1;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);position:relative;font-size:.9em}.alert:before{content:"!";position:absolute;top:12px;left:-14px;display:block;width:24px;height:24px;background:#ba3525;font-size:12px;padding:0 4px;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;font-weight:700;color:#fff;line-height:22px;border-radius:50%}.alert a{color:#ba3525}.alert :last-child{margin-bottom:0}.toc{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0;list-style:none;margin-left:-4px}.toc li{margin:4px}.toc a{display:-webkit-box;display:-ms-flexbox;display:flex;background-color:#584b4f;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-weight:bolder;letter-spacing:normal;padding:.25rem 1rem .15rem;border-radius:4px}.toc a,.toc a:hover{color:#fff;text-decoration:none}@media (max-width:768px){.toc{font-size:.85rem}}.welcome__intro{padding:16px 0 136px;border-bottom:1px dashed #eae8e3;background-image:-webkit-radial-gradient(center,ellipse,#fff 0,#eae8e3 100%);background-image:-o-radial-gradient(center,ellipse,#fff 0,#eae8e3 100%);background-image:radial-gradient(ellipse at center,#fff 0,#eae8e3 100%);background-size:auto 100%;background-position:50% 0}.welcome__intro h1{font-size:32px;font-size:2rem;margin-bottom:16px;color:#4f5b93}.welcome__logo{display:block;margin:0 auto;max-width:320px}.welcome__logo svg{display:block;height:240px}.welcome__content{padding-top:16px;display:block;max-width:calc(98% - 320px)}.welcome__example{display:block;max-width:850px;margin:-160px auto auto}.welcome__example .highlight pre{padding:32px;background:#fff;-webkit-box-shadow:0 0 16px #d6d1c8;box-shadow:0 0 16px #d6d1c8}.welcome__intro .links a{color:#584b4f;text-decoration:none}.welcome__intro .links a:hover{color:#4f5b93;text-decoration:none}@media (max-width:768px){.welcome__content{padding:32px 16px 16px;max-width:100%}.welcome__logo svg{height:160px}.welcome__intro h1{text-align:center;font-size:1.75rem;margin-bottom:16px;color:#4f5b93}.welcome__intro .links{text-align:center}}.off-canvas-menu{position:fixed;top:0;right:0;pointer-events:none}.off-canvas-menu__content{-webkit-transform:translate3d(105%,0,0);transform:translate3d(105%,0,0)}.component-info{position:-webkit-sticky;position:sticky;top:16px;bottom:16px;padding:24px;background-color:#f4f3f1;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);border-radius:4px;color:#584b4f;font-size:14px;font-size:.875rem}.component-info a,.component-info a [class*=icon]{color:#584b4f}.component-info a:hover{color:#afa1a5;text-decoration:none}.component-info pre{line-height:1;font-size:12px;font-size:.75rem}.component-info__title{display:-webkit-box;display:-ms-flexbox;display:flex;font-size:24px;font-size:1.5rem;line-height:16px;line-height:1rem;margin-bottom:1rem;color:#584b4f;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.component-info__title a{text-decoration:none}.component-info__title>:not(:last-child){margin-right:8px}.component-info__subtitle{font-size:14px;font-size:.875rem;line-height:14px;line-height:.875rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;margin-bottom:.875rem;color:#afa1a5}.component-info__info{padding:0;list-style:none;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-flow:row;flex-flow:row;-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start}.component-info__info li{margin-right:16px}.component-info__info li:last-child{margin-right:0}.component-info__info a{font-size:12px;font-size:.75rem;text-decoration:none;white-space:nowrap;-o-text-overflow:ellipsis;text-overflow:ellipsis}.component-info__contributors{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0;list-style:none}.component-info__contributors li{padding:0 4px 4px 0;margin:0}.component-info__contributors img{display:block;width:40px;height:auto;border-radius:2px}.component-info__contributors img,.component-info__participation{-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1)}.component-info__participation{background-color:#f9f9f8;padding:8px;border-radius:4px;text-align:center}.component-info__participation svg{display:block;margin:auto;max-width:100%;height:auto!important}.version-selector{position:relative;font-size:14px;font-size:.875rem;color:#fff}.version-selector :last-child{margin-bottom:0}.version-selector__button,.version-selector__version{-webkit-appearance:none;border:0;margin:0;text-shadow:none;-webkit-box-shadow:none;box-shadow:none;text-decoration:none;text-transform:none;overflow:visible;cursor:pointer;outline:none;display:-webkit-box;display:-ms-flexbox;display:flex;background-color:#584b4f;-webkit-box-shadow:0 1px 0 0 rgba(0,0,0,.1);box-shadow:0 1px 0 0 rgba(0,0,0,.1);color:#fff;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;font-size:.75rem;font-weight:bolder;letter-spacing:normal;padding:.25rem .4rem .2rem;border-radius:4px}.version-selector__button{position:relative}.version-selector__button [class=icon-chevron-down]{display:inline-block;margin-left:4px}.version-selector__button [class=icon-chevron-up]{display:none;margin-left:4px}.version-selector__version{background-color:hsla(0,0%,100%,.33);border:1px solid transparent;text-decoration:none;color:#fff!important}.version-selector__version:hover{background-color:hsla(0,0%,100%,.11);border:1px solid hsla(0,0%,100%,.22)}.version-selector__button--dev,.version-selector__version--dev,.version-selector__version--dev:hover{background-color:#ba3525}.version-selector__button--latest,.version-selector__version--latest,.version-selector__version--latest:hover{background-color:#40a977}.version-selector__panel{position:fixed;top:-20000em;visibility:hidden}</style>
        <script async src="../assets/main.f372b8b9.js"></script>
            </head>

    <body>
            <header class="header">
            <div class="wrapper">
                <div class="header__container">
                    <a class="header__logo" href="../">
                        <svg xmlns="http://www.w3.org/2000/svg" width="320" height="47.29" viewBox="0 428.964 320 47.29"><path fill="#584B4F" d="M30.86 452.385c1.637-2.287 2.455-5 2.455-8.134 0-4.313-1.367-7.87-4.088-10.68-2.723-2.812-6.39-4.216-11.004-4.216h-7.71c-3.79 0-6.49.798-8.1 2.388C.806 433.332 0 435.872 0 439.355v36.512h9.08v-17.245h6.53l9.08 17.245h10.52L24.82 457.12c2.395-.87 4.41-2.447 6.04-4.735zm-8.488-3.334c-1.24 1.33-2.82 1.99-4.734 1.99H9.08v-9.47c0-2.74 1.35-4.112 4.05-4.112h4.508c2 0 3.603.61 4.8 1.83 1.196 1.22 1.797 2.82 1.797 4.802 0 1.982-.623 3.64-1.864 4.964v-.003zm20.348 14.536c0 4.572 1.055 7.766 3.167 9.57 2.114 1.81 5.782 2.71 11.008 2.71h16.46v-8.1H57.548c-2.18 0-3.68-.35-4.51-1.045-.83-.695-1.24-1.96-1.24-3.788v-6.467h14.434l.656-8.1h-15.09v-10.912h21.56v-8.098H42.72v34.23zm57.97-33.442c-.718-.523-1.665-.787-2.84-.787-1.177 0-2.168.285-2.972.85-.807.567-1.537 1.592-2.19 3.073l-14.89 42.585h9.47l2.55-8.03h15.613l2.613 8.03h9.47l-14.893-42.588c-.567-1.572-1.21-2.613-1.93-3.135v.002zM92.1 460.19l5.75-18.42 5.487 18.418H92.1v.002zm53.074 5.455c-1.155 1.678-3.245 2.512-6.27 2.512-3.03 0-5.258-.914-6.697-2.74-1.394-1.83-2.093-5.25-2.093-10.256v-4.052c0-1.783.045-3.2.13-4.243.178-3.27.785-5.576 1.833-6.928 1.48-1.914 3.745-2.873 6.794-2.873 2.613 0 4.532.653 5.75 1.96 1.218 1.308 2.07 3.245 2.547 5.813h8.49c0-5.14-1.557-9.07-4.67-11.79-3.114-2.723-7.153-4.084-12.116-4.084-3.398 0-6.293.564-8.687 1.7-6.097 2.783-9.146 9.686-9.146 20.704v3.918c0 13.982 5.945 20.968 17.833 20.968 5.4 0 9.58-1.59 12.54-4.77 2.964-3.176 4.44-7.73 4.44-13.653h-8.426c-.346 3.53-1.1 6.134-2.25 7.81v.005zm14.667-36.29v8.1h12.412v38.41h9.08v-38.41h12.47v-8.1"/><path fill="#4F5B93" d="M218.89 429.356h-18.03v46.51h9.086v-14.897h8.944c4.876 0 8.647-1.337 11.328-4.016 2.683-2.68 4.02-6.608 4.02-11.788s-1.337-9.112-4.02-11.788c-2.68-2.68-6.454-4.02-11.328-4.02v-.002zm4.538 21.686c-1.15 1.177-2.815 1.768-5 1.768h-8.485v-15.354h8.484c4.483 0 6.73 2.572 6.73 7.71 0 2.744-.578 4.703-1.73 5.88v-.004zm43.93-2.02H250.31v-19.666h-9.088v46.51h9.086v-18.81h17.05v18.81h9.076v-46.51h-9.078m48.63 4.02c-2.683-2.68-6.46-4.02-11.335-4.02h-18.027v46.507h9.085V460.97h8.943c4.877 0 8.654-1.336 11.337-4.014 2.68-2.678 4.013-6.608 4.013-11.788s-1.332-9.112-4.013-11.79v-.003zm-6.795 17.666c-1.154 1.177-2.822 1.768-5 1.768h-8.484v-15.354h8.485c4.483 0 6.734 2.572 6.734 7.71 0 2.744-.583 4.703-1.735 5.88v-.004z"/></svg>
                    </a>
                    <form class="header__search">
                        <input type="search" class="searchbox searchbox--collapsed" data-docsearch placeholder="Search documentation...">
                    </form>
                    <div class="header__menu">
    <button class="hamburger" data-ctrly="off-canvas-menu" data-off-canvas-menu-control>
        <div class="hamburger__box">
            <div class="hamburger__inner">
                <span class="visually-hidden">Menu</span>
            </div>
        </div>
    </button>
</div>
<nav id="off-canvas-menu" class="off-canvas-menu" aria-hidden="true" tabindex="0">
    <div class="off-canvas-menu__content">
        <button aria-label="Close menu" class="off-canvas-menu__close" data-ctrly="off-canvas-menu" data-off-canvas-menu-control>
            <i class="icon-x" aria-hidden="true"></i>
        </button>

        <section class="off-canvas-menu__section">
            <a class="off-canvas-menu__section-top" href="../">Home</a>
        </section>

        <section class="off-canvas-menu__section">
            <a class="off-canvas-menu__section-top" href="../changelog.html">Changelog</a>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Core Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../event-loop/">
                        EventLoop

                        <span class="off-canvas-menu__version">
                            v1.1.0
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../stream/">
                        Stream

                        <span class="off-canvas-menu__version">
                            v1.1.0
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise/">
                        Promise

                        <span class="off-canvas-menu__version">
                            v2.7.1
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Network Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../socket/">
                        Socket

                        <span class="off-canvas-menu__version">
                            v1.3.0
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../datagram/">
                        Datagram

                        <span class="off-canvas-menu__version">
                            v1.5.0
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Protocol Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../http/">
                        HTTP

                        <span class="off-canvas-menu__version">
                            v0.8.5
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../http-client/">
                        HTTPClient

                        <span class="off-canvas-menu__version">
                            v0.5.9
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../dns/">
                        DNS

                        <span class="off-canvas-menu__version">
                            v1.2.0
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
            <section class="off-canvas-menu__section">
            <h3 class="off-canvas-menu__section-header">Utility Components</h3>
            <ul class="off-canvas-menu__list">
                            <li>
                    <a class="off-canvas-menu__link" href="../cache/">
                        Cache

                        <span class="off-canvas-menu__version">
                            v1.0.0
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../child-process/">
                        ChildProcess

                        <span class="off-canvas-menu__version">
                            v0.6.1
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise-timer/">
                        PromiseTimer

                        <span class="off-canvas-menu__version">
                            v1.5.1
                        </span>
                    </a>
                </li>
                            <li>
                    <a class="off-canvas-menu__link" href="../promise-stream/">
                        PromiseStream

                        <span class="off-canvas-menu__version">
                            v1.2.0
                        </span>
                    </a>
                </li>
                        </ul>
        </section>
        </div>
</nav>
                </div>
            </div>
        </header>
    
        <div class="container">
        <div class="wrapper">
            <div class="grid grid--wrap grid--gutter">
                <main class="main">
                                    <h1>HTTP</h1>

                    
<p><a href="https://travis-ci.org/reactphp/http" rel="nofollow"><img src="https://camo.githubusercontent.com/659589f9f68532b51e5460a93dde82ff4fec20de/68747470733a2f2f7472617669732d63692e6f72672f72656163747068702f687474702e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/reactphp/http.svg?branch=master" style="max-width:100%;"></a></p>
<p>Event-driven, streaming plaintext HTTP and secure HTTPS server for <a href="https://reactphp.org/" rel="nofollow">ReactPHP</a>.</p>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#quickstart-example">Quickstart example</a></li>
<li>
<a href="#usage">Usage</a>
<ul>
<li><a href="#server">Server</a></li>
<li><a href="#streamingserver">StreamingServer</a></li>
<li><a href="#listen">listen()</a></li>
<li>
<a href="#request">Request</a>
<ul>
<li><a href="#request-parameters">Request parameters</a></li>
<li><a href="#query-parameters">Query parameters</a></li>
<li><a href="#request-body">Request body</a></li>
<li><a href="#streaming-request">Streaming request</a></li>
<li><a href="#request-method">Request method</a></li>
<li><a href="#cookie-parameters">Cookie parameters</a></li>
<li><a href="#invalid-request">Invalid request</a></li>
</ul>
</li>
<li>
<a href="#response">Response</a>
<ul>
<li><a href="#deferred-response">Deferred response</a></li>
<li><a href="#streaming-response">Streaming response</a></li>
<li><a href="#response-length">Response length</a></li>
<li><a href="#invalid-response">Invalid response</a></li>
<li><a href="#default-response-headers">Default response headers</a></li>
</ul>
</li>
<li>
<a href="#middleware">Middleware</a>
<ul>
<li><a href="#limitconcurrentrequestsmiddleware">LimitConcurrentRequestsMiddleware</a></li>
<li><a href="#requestbodybuffermiddleware">RequestBodyBufferMiddleware</a></li>
<li><a href="#requestbodyparsermiddleware">RequestBodyParserMiddleware</a></li>
<li><a href="#third-party-middleware">Third-Party Middleware</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#install">Install</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>
<a id="quickstart-example" class="anchor" href="#quickstart-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quickstart example</h2>
<p>This is an HTTP server which responds with <code>Hello World!</code> to every request.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$loop</span> <span class="pl-k">=</span> <span class="pl-c1">React\EventLoop\</span><span class="pl-c1">Factory</span><span class="pl-k">::</span>create();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-c1">8080</span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>run();</span></pre></div>
<p>See also the <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">examples</a>.</p>
<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>
<h3>
<a id="server" class="anchor" href="#server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Server</h3>
<p>The <code>Server</code> class is responsible for handling incoming connections and then
processing each incoming HTTP request.</p>
<p>It buffers and parses the complete incoming HTTP request in memory. Once the
complete request has been received, it will invoke the request handler function.
This request handler function needs to be passed to the constructor and will be
invoked with the respective <a href="#request">request</a> object and expects a
<a href="#response">response</a> object in return:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Each incoming HTTP request message is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#321-psrhttpmessageserverrequestinterface" rel="nofollow">PSR-7 <code>ServerRequestInterface</code></a>,
see also following <a href="#request">request</a> chapter for more details.
Each outgoing HTTP response message is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#33-psrhttpmessageresponseinterface" rel="nofollow">PSR-7 <code>ResponseInterface</code></a>,
see also following <a href="#response">response</a> chapter for more details.</p>
<p>In order to process any connections, the server needs to be attached to an
instance of <code>React\Socket\ServerInterface</code> through the <a href="#listen"><code>listen()</code></a> method
as described in the following chapter. In its most simple form, you can attach
this to a <a href="../socket/#server"><code>React\Socket\Server</code></a>
in order to start a plaintext HTTP server like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-s"><span class="pl-pds">'</span>0.0.0.0:8080<span class="pl-pds">'</span></span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>See also the <a href="#listen"><code>listen()</code></a> method and the <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">first example</a> for more details.</p>
<p>The <code>Server</code> class is built as a facade around the underlying
<a href="#streamingserver"><code>StreamingServer</code></a> to provide sane defaults for 80% of the
use cases and is the recommended way to use this library unless you're sure
you know what you're doing.</p>
<p>Unlike the underlying <a href="#streamingserver"><code>StreamingServer</code></a>, this class
buffers and parses the complete incoming HTTP request in memory. Once the
complete request has been received, it will invoke the request handler
function. This means the <a href="#request">request</a> passed to your request handler
function will be fully compatible with PSR-7.</p>
<p>On the other hand, buffering complete HTTP requests in memory until they can
be processed by your request handler function means that this class has to
employ a number of limits to avoid consuming too much memory. In order to
take the more advanced configuration out your hand, it respects setting from
your <a href="https://www.php.net/manual/en/ini.core.php" rel="nofollow"><code>php.ini</code></a> to apply its
default settings. This is a list of PHP settings this class respects with
their respective default values:</p>
<pre><code>memory_limit 128M
post_max_size 8M
enable_post_data_reading 1
max_input_nesting_level 64
max_input_vars 1000

file_uploads 1
upload_max_filesize 2M
max_file_uploads 20
</code></pre>
<p>In particular, the <code>post_max_size</code> setting limits how much memory a single HTTP
request is allowed to consume while buffering its request body. On top of
this, this class will try to avoid consuming more than 1/4 of your
<code>memory_limit</code> for buffering multiple concurrent HTTP requests. As such, with
the above default settings of <code>128M</code> max, it will try to consume no more than
<code>32M</code> for buffering multiple concurrent HTTP requests. As a consequence, it
will limit the concurrency to 4 HTTP requests with the above defaults.</p>
<p>It is imperative that you assign reasonable values to your PHP ini settings.
It is usually recommended to either reduce the memory a single request is
allowed to take (set <code>post_max_size 1M</code> or less) or to increase the total memory
limit to allow for more concurrent requests (set <code>memory_limit 512M</code> or more).
Failure to do so means that this class may have to disable concurrency and
only handle one request at a time.</p>
<p>Internally, this class automatically assigns these limits to the
<a href="#middleware">middleware</a> request handlers as described below. For more
advanced use cases, you may also use the advanced
<a href="#streamingserver"><code>StreamingServer</code></a> and assign these middleware request
handlers yourself as described in the following chapters.</p>
<h3>
<a id="streamingserver" class="anchor" href="#streamingserver" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>StreamingServer</h3>
<p>The advanced <code>StreamingServer</code> class is responsible for handling incoming connections and then
processing each incoming HTTP request.</p>
<p>Unlike the <a href="#server"><code>Server</code></a> class, it does not buffer and parse the incoming
HTTP request body by default. This means that the request handler will be
invoked with a streaming request body. Once the request headers have been
received, it will invoke the request handler function. This request handler
function needs to be passed to the constructor and will be invoked with the
respective <a href="#request">request</a> object and expects a <a href="#response">response</a>
object in return:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Each incoming HTTP request message is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#321-psrhttpmessageserverrequestinterface" rel="nofollow">PSR-7 <code>ServerRequestInterface</code></a>,
see also following <a href="#request">request</a> chapter for more details.
Each outgoing HTTP response message is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#33-psrhttpmessageresponseinterface" rel="nofollow">PSR-7 <code>ResponseInterface</code></a>,
see also following <a href="#response">response</a> chapter for more details.</p>
<p>In order to process any connections, the server needs to be attached to an
instance of <code>React\Socket\ServerInterface</code> through the <a href="#listen"><code>listen()</code></a> method
as described in the following chapter. In its most simple form, you can attach
this to a <a href="../socket/#server"><code>React\Socket\Server</code></a>
in order to start a plaintext HTTP server like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-s"><span class="pl-pds">'</span>0.0.0.0:8080<span class="pl-pds">'</span></span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>See also the <a href="#listen"><code>listen()</code></a> method and the <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">first example</a> for more details.</p>
<p>The <code>StreamingServer</code> class is considered advanced usage and unless you know
what you're doing, you're recommended to use the <a href="#server"><code>Server</code></a> class
instead. The <code>StreamingServer</code> class is specifically designed to help with
more advanced use cases where you want to have full control over consuming
the incoming HTTP request body and concurrency settings.</p>
<p>In particular, this class does not buffer and parse the incoming HTTP request
in memory. It will invoke the request handler function once the HTTP request
headers have been received, i.e. before receiving the potentially much larger
HTTP request body. This means the <a href="#request">request</a> passed to your request
handler function may not be fully compatible with PSR-7. See also
<a href="#streaming-request">streaming request</a> below for more details.</p>
<h3>
<a id="listen" class="anchor" href="#listen" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>listen()</h3>
<p>The <code>listen(React\Socket\ServerInterface $socket): void</code> method can be used to
start processing connections from the given socket server.
The given <a href="../socket/#serverinterface"><code>React\Socket\ServerInterface</code></a>
is responsible for emitting the underlying streaming connections.
This HTTP server needs to be attached to it in order to process any connections
and pase incoming streaming data as incoming HTTP request messages.
In its most common form, you can attach this to a
<a href="../socket/#server"><code>React\Socket\Server</code></a>
in order to start a plaintext HTTP server like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> or</span></span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-s"><span class="pl-pds">'</span>0.0.0.0:8080<span class="pl-pds">'</span></span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>This example will start listening for HTTP requests on the alternative HTTP port
<code>8080</code> on all interfaces (publicly). As an alternative, it is very common to use
a reverse proxy and let this HTTP server listen on the localhost (loopback)
interface only by using the listen address <code>127.0.0.1:8080</code> instead. This way, you
host your application(s) on the default HTTP port <code>80</code> and only route specific
requests to this HTTP server.</p>
<p>Likewise, it's usually recommended to use a reverse proxy setup to accept
secure HTTPS requests on default HTTPS port <code>443</code> (TLS termination) and only
route plaintext requests to this HTTP server. As an alternative, you can also
accept secure HTTPS requests with this HTTP server by attaching this to a
<a href="../socket/#server"><code>React\Socket\Server</code></a> using a
secure TLS listen address, a certificate file and optional <code>passphrase</code> like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"><span class="pl-c"><span class="pl-c">//</span> or</span></span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-s"><span class="pl-pds">'</span>tls://0.0.0.0:8443<span class="pl-pds">'</span></span>, <span class="pl-smi">$loop</span>, <span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>local_cert<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">__DIR__</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/localhost.pem<span class="pl-pds">'</span></span></span>
<span class="pl-s1">));</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #11</a> for more details.</p>
<h3>
<a id="request" class="anchor" href="#request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request</h3>
<p>As seen above, the <a href="#server"><code>Server</code></a> and <a href="#streamingserver"><code>StreamingServer</code></a>
classes are responsible for handling incoming connections and then processing
each incoming HTTP request.</p>
<p>The request object will be processed once the request has
been received by the client.
This request object implements the
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#321-psrhttpmessageserverrequestinterface">PSR-7 ServerRequestInterface</a>
which in turn extends the
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#32-psrhttpmessagerequestinterface">PSR-7 RequestInterface</a>
and will be passed to the callback function like this.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">   <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>The method of the request is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getMethod();</span>
<span class="pl-s1">   <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">"</span>The requested path is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getUri()<span class="pl-k">-&gt;</span>getPath();</span>
<span class="pl-s1"></span>
<span class="pl-s1">   <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">       <span class="pl-c1">200</span>,</span>
<span class="pl-s1">       <span class="pl-c1">array</span>(</span>
<span class="pl-s1">           <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">       ),</span>
<span class="pl-s1">       <span class="pl-smi">$body</span></span>
<span class="pl-s1">   );</span>
<span class="pl-s1">});</span></pre></div>
<p>For more details about the request object, also check out the documentation of
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#321-psrhttpmessageserverrequestinterface">PSR-7 ServerRequestInterface</a>
and
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#32-psrhttpmessagerequestinterface">PSR-7 RequestInterface</a>.</p>
<h4>
<a id="request-parameters" class="anchor" href="#request-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request parameters</h4>
<p>The <code>getServerParams(): mixed[]</code> method can be used to
get server-side parameters similar to the <code>$_SERVER</code> variable.
The following parameters are currently available:</p>
<ul>
<li>
<code>REMOTE_ADDR</code>
The IP address of the request sender</li>
<li>
<code>REMOTE_PORT</code>
Port of the request sender</li>
<li>
<code>SERVER_ADDR</code>
The IP address of the server</li>
<li>
<code>SERVER_PORT</code>
The port of the server</li>
<li>
<code>REQUEST_TIME</code>
Unix timestamp when the complete request header has been received,
as integer similar to <code>time()</code>
</li>
<li>
<code>REQUEST_TIME_FLOAT</code>
Unix timestamp when the complete request header has been received,
as float similar to <code>microtime(true)</code>
</li>
<li>
<code>HTTPS</code>
Set to 'on' if the request used HTTPS, otherwise it won't be set</li>
</ul>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Your IP is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getServerParams()[<span class="pl-s"><span class="pl-pds">'</span>REMOTE_ADDR<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$body</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #3</a>.</p>
<blockquote>
<p>Advanced: Note that address parameters will not be set if you're listening on
a Unix domain socket (UDS) path as this protocol lacks the concept of
host/port.</p>
</blockquote>
<h4>
<a id="query-parameters" class="anchor" href="#query-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Query parameters</h4>
<p>The <code>getQueryParams(): array</code> method can be used to get the query parameters
similiar to the <code>$_GET</code> variable.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$queryParams</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getQueryParams();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The query parameter "foo" is not set. Click the following link <span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;a href="/?foo=bar"&gt;to use query parameter in your request&lt;/a&gt;<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-c1">isset</span>(<span class="pl-smi">$queryParams</span>[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>])) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The value of "foo" is: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">htmlspecialchars</span>(<span class="pl-smi">$queryParams</span>[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$body</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The response in the above example will return a response body with a link.
The URL contains the query parameter <code>foo</code> with the value <code>bar</code>.
Use <a href="https://www.php.net/manual/en/function.htmlentities.php" rel="nofollow"><code>htmlentities</code></a>
like in this example to prevent
<a href="https://en.wikipedia.org/wiki/Cross-site_scripting" rel="nofollow">Cross-Site Scripting (abbreviated as XSS)</a>.</p>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #4</a>.</p>
<h4>
<a id="request-body" class="anchor" href="#request-body" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request body</h4>
<p>If you're using the <a href="#server"><code>Server</code></a>, then the request object will be
buffered and parsed in memory and contains the full request body.
This includes the parsed request body and any file uploads.</p>
<blockquote>
<p>If you're using the advanced <a href="#streamingserver"><code>StreamingServer</code></a> class, jump
to the next chapter to learn more about how to process a
<a href="#streaming-request">streaming request</a>.</p>
</blockquote>
<p>As stated above, each incoming HTTP request is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#321-psrhttpmessageserverrequestinterface" rel="nofollow">PSR-7 <code>ServerRequestInterface</code></a>.
This interface provides several methods that are useful when working with the
incoming request body as described below.</p>
<p>The <code>getParsedBody(): null|array|object</code> method can be used to
get the parsed request body, similar to
<a href="https://www.php.net/manual/en/reserved.variables.post.php" rel="nofollow">PHP's <code>$_POST</code> variable</a>.
This method may return a (possibly nested) array structure with all body
parameters or a <code>null</code> value if the request body could not be parsed.
By default, this method will only return parsed data for requests using
<code>Content-Type: application/x-www-form-urlencoded</code> or <code>Content-Type: multipart/form-data</code>
request headers (commonly used for <code>POST</code> requests for HTML form submission data).</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$name</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getParsedBody()[<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>] ?? <span class="pl-s"><span class="pl-pds">'</span>anonymous<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello <span class="pl-smi">$name</span>!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #12</a> for more details.</p>
<p>The <code>getBody(): StreamInterface</code> method can be used to
get the raw data from this request body, similar to
<a href="https://www.php.net/manual/en/wrappers.php.php#wrappers.php.input" rel="nofollow">PHP's <code>php://input</code> stream</a>.
This method returns an instance of the request body represented by the
<a href="https://www.php-fig.org/psr/psr-7/#34-psrhttpmessagestreaminterface" rel="nofollow">PSR-7 <code>StreamInterface</code></a>.
This is particularly useful when using a custom request body that will not
otherwise be parsed by default, such as a JSON (<code>Content-Type: application/json</code>) or
an XML (<code>Content-Type: application/xml</code>) request body (which is commonly used for
<code>POST</code>, <code>PUT</code> or <code>PATCH</code> requests in JSON-based or RESTful/RESTish APIs).</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$data</span> <span class="pl-k">=</span> <span class="pl-c1">json_decode</span>((<span class="pl-k">string</span>)<span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody());</span>
<span class="pl-s1">    <span class="pl-smi">$name</span> <span class="pl-k">=</span> <span class="pl-smi">$data</span><span class="pl-k">-&gt;</span><span class="pl-smi">name</span> ?? <span class="pl-s"><span class="pl-pds">'</span>anonymous<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>application/json<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-c1">json_encode</span>([<span class="pl-s"><span class="pl-pds">'</span>message<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">"</span>Hello <span class="pl-smi">$name</span>!<span class="pl-pds">"</span></span>])</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #9</a> for more details.</p>
<p>The <code>getUploadedFiles(): array</code> method can be used to
get the uploaded files in this request, similar to
<a href="https://www.php.net/manual/en/reserved.variables.files.php" rel="nofollow">PHP's <code>$_FILES</code> variable</a>.
This method returns a (possibly nested) array structure with all file uploads, each represented by the
<a href="https://www.php-fig.org/psr/psr-7/#36-psrhttpmessageuploadedfileinterface" rel="nofollow">PSR-7 <code>UploadedFileInterface</code></a>.
This array will only be filled when using the <code>Content-Type: multipart/form-data</code>
request header (commonly used for <code>POST</code> requests for HTML file uploads).</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$files</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getUploadedFiles();</span>
<span class="pl-s1">    <span class="pl-smi">$name</span> <span class="pl-k">=</span> <span class="pl-c1">isset</span>(<span class="pl-smi">$files</span>[<span class="pl-s"><span class="pl-pds">'</span>avatar<span class="pl-pds">'</span></span>]) ? <span class="pl-smi">$files</span>[<span class="pl-s"><span class="pl-pds">'</span>avatar<span class="pl-pds">'</span></span>]<span class="pl-k">-&gt;</span>getClientFilename() : <span class="pl-s"><span class="pl-pds">'</span>nothing<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Uploaded <span class="pl-smi">$name</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #12</a> for more details.</p>
<p>The <code>getSize(): ?int</code> method can be used to
get the size of the request body, similar to PHP's <code>$_SERVER['CONTENT_LENGTH']</code> variable.
This method returns the complete size of the request body measured in number
of bytes as defined by the message boundaries.
This value may be <code>0</code> if the request message does not contain a request body
(such as a simple <code>GET</code> request).
This method operates on the buffered request body, i.e. the request body size
is always known, even when the request does not specify a <code>Content-Length</code> request
header or when using <code>Transfer-Encoding: chunked</code> for HTTP/1.1 requests.</p>
<blockquote>
<p>Note: The <code>Server</code> automatically takes care of handling requests with the
additional <code>Expect: 100-continue</code> request header. When HTTP/1.1 clients want to
send a bigger request body, they MAY send only the request headers with an
additional <code>Expect: 100-continue</code> request header and wait before sending the actual
(large) message body. In this case the server will automatically send an
intermediary <code>HTTP/1.1 100 Continue</code> response to the client. This ensures you
will receive the request body without a delay as expected.</p>
</blockquote>
<h4>
<a id="streaming-request" class="anchor" href="#streaming-request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Streaming request</h4>
<p>If you're using the advanced <a href="#streamingserver"><code>StreamingServer</code></a>, the
request object will be processed once the request headers have been received.
This means that this happens irrespective of (i.e. <em>before</em>) receiving the
(potentially much larger) request body.</p>
<blockquote>
<p>If you're using the <a href="#server"><code>Server</code></a> class, jump to the previous chapter
to learn more about how to process a buffered <a href="#request-body">request body</a>.</p>
</blockquote>
<p>While this may be uncommon in the PHP ecosystem, this is actually a very powerful
approach that gives you several advantages not otherwise possible:</p>
<ul>
<li>React to requests <em>before</em> receiving a large request body,
such as rejecting an unauthenticated request or one that exceeds allowed
message lengths (file uploads).</li>
<li>Start processing parts of the request body before the remainder of the request
body arrives or if the sender is slowly streaming data.</li>
<li>Process a large request body without having to buffer anything in memory,
such as accepting a huge file upload or possibly unlimited request body stream.</li>
</ul>
<p>The <code>getBody(): StreamInterface</code> method can be used to
access the request body stream.
In the streaming mode, this method returns a stream instance that implements both the
<a href="https://www.php-fig.org/psr/psr-7/#34-psrhttpmessagestreaminterface" rel="nofollow">PSR-7 <code>StreamInterface</code></a>
and the <a href="../stream/#readablestreaminterface">ReactPHP <code>ReadableStreamInterface</code></a>.
However, most of the PSR-7 <code>StreamInterface</code> methods have been
designed under the assumption of being in control of a synchronous request body.
Given that this does not apply to this server, the following
PSR-7 <code>StreamInterface</code> methods are not used and SHOULD NOT be called:
<code>tell()</code>, <code>eof()</code>, <code>seek()</code>, <code>rewind()</code>, <code>write()</code> and <code>read()</code>.
If this is an issue for your use case and/or you want to access uploaded files,
it's highly recommended to use a buffered <a href="#request-body">request body</a> or use the
<a href="#requestbodybuffermiddleware"><code>RequestBodyBufferMiddleware</code></a> instead.
The ReactPHP <code>ReadableStreamInterface</code> gives you access to the incoming
request body as the individual chunks arrive:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">$resolve</span>, <span class="pl-smi">$reject</span>) <span class="pl-k">use</span> (<span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$contentLength</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$data</span>) <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$contentLength</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-c1">strlen</span>(<span class="pl-smi">$data</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$resolve</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>){</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">200</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(</span>
<span class="pl-s1">                    <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">                ),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>The length of the submitted request body is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$contentLength</span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> an error occures e.g. on invalid chunked encoded data or an unexpected 'end' event</span></span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">\Exception</span> <span class="pl-smi">$exception</span>) <span class="pl-k">use</span> (<span class="pl-smi">$resolve</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">400</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(</span>
<span class="pl-s1">                    <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">                ),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>An error occured while reading at length: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$contentLength</span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example simply counts the number of bytes received in the request body.
This can be used as a skeleton for buffering or processing the request body.</p>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #13</a> for more details.</p>
<p>The <code>data</code> event will be emitted whenever new data is available on the request
body stream.
The server also automatically takes care of decoding any incoming requests using
<code>Transfer-Encoding: chunked</code> and will only emit the actual payload as data.</p>
<p>The <code>end</code> event will be emitted when the request body stream terminates
successfully, i.e. it was read until its expected end.</p>
<p>The <code>error</code> event will be emitted in case the request stream contains invalid
data for <code>Transfer-Encoding: chunked</code> or when the connection closes before
the complete request stream has been received.
The server will automatically stop reading from the connection and discard all
incoming data instead of closing it.
A response message can still be sent (unless the connection is already closed).</p>
<p>A <code>close</code> event will be emitted after an <code>error</code> or <code>end</code> event.</p>
<p>For more details about the request body stream, check out the documentation of
<a href="../stream/#readablestreaminterface">ReactPHP ReadableStreamInterface</a>.</p>
<p>The <code>getSize(): ?int</code> method can be used to
get the size of the request body, similar to PHP's <code>$_SERVER['CONTENT_LENGTH']</code> variable.
This method returns the complete size of the request body measured in number
of bytes as defined by the message boundaries.
This value may be <code>0</code> if the request message does not contain a request body
(such as a simple <code>GET</code> request).
This method operates on the streaming request body, i.e. the request body size
may be unknown (<code>null</code>) when using <code>Transfer-Encoding: chunked</code> for HTTP/1.1 requests.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$size</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>getSize();</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$size</span> <span class="pl-k">===</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The request does not contain an explicit length.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">'</span>This example does not accept chunked transfer encoding.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">            <span class="pl-c1">411</span>,</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">            ),</span>
<span class="pl-s1">            <span class="pl-smi">$body</span></span>
<span class="pl-s1">        );</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Request body size: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$size</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">"</span> bytes<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<blockquote>
<p>Note: The <code>StreamingServer</code> automatically takes care of handling requests with the
additional <code>Expect: 100-continue</code> request header. When HTTP/1.1 clients want to
send a bigger request body, they MAY send only the request headers with an
additional <code>Expect: 100-continue</code> request header and wait before sending the actual
(large) message body. In this case the server will automatically send an
intermediary <code>HTTP/1.1 100 Continue</code> response to the client. This ensures you
will receive the streaming request body without a delay as expected.</p>
</blockquote>
<h4>
<a id="request-method" class="anchor" href="#request-method" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request method</h4>
<p>Note that the server supports <em>any</em> request method (including custom and non-
standard ones) and all request-target formats defined in the HTTP specs for each
respective method, including <em>normal</em> <code>origin-form</code> requests as well as
proxy requests in <code>absolute-form</code> and <code>authority-form</code>.
The <code>getUri(): UriInterface</code> method can be used to get the effective request
URI which provides you access to individiual URI components.
Note that (depending on the given <code>request-target</code>) certain URI components may
or may not be present, for example the <code>getPath(): string</code> method will return
an empty string for requests in <code>asterisk-form</code> or <code>authority-form</code>.
Its <code>getHost(): string</code> method will return the host as determined by the
effective request URI, which defaults to the local socket address if a HTTP/1.0
client did not specify one (i.e. no <code>Host</code> header).
Its <code>getScheme(): string</code> method will return <code>http</code> or <code>https</code> depending
on whether the request was made over a secure TLS connection to the target host.</p>
<p>The <code>Host</code> header value will be sanitized to match this host component plus the
port component only if it is non-standard for this URI scheme.</p>
<p>You can use <code>getMethod(): string</code> and <code>getRequestTarget(): string</code> to
check this is an accepted request and may want to reject other requests with
an appropriate error code, such as <code>400</code> (Bad Request) or <code>405</code> (Method Not
Allowed).</p>
<blockquote>
<p>The <code>CONNECT</code> method is useful in a tunneling setup (HTTPS proxy) and not
something most HTTP servers would want to care about.
Note that if you want to handle this method, the client MAY send a different
request-target than the <code>Host</code> header value (such as removing default ports)
and the request-target MUST take precendence when forwarding.</p>
</blockquote>
<h4>
<a id="cookie-parameters" class="anchor" href="#cookie-parameters" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Cookie parameters</h4>
<p>The <code>getCookieParams(): string[]</code> method can be used to
get all cookies sent with the current request.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$key</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>react\php<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-c1">isset</span>(<span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getCookieParams()[<span class="pl-smi">$key</span>])) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Your cookie value is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getCookieParams()[<span class="pl-smi">$key</span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">            <span class="pl-c1">200</span>,</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">            ),</span>
<span class="pl-s1">            <span class="pl-smi">$body</span></span>
<span class="pl-s1">        );</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Set-Cookie<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">urlencode</span>(<span class="pl-smi">$key</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>=<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">urlencode</span>(<span class="pl-s"><span class="pl-pds">'</span>test;more<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Your cookie has been set.<span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will try to set a cookie on first access and
will try to print the cookie value on all subsequent tries.
Note how the example uses the <code>urlencode()</code> function to encode
non-alphanumeric characters.
This encoding is also used internally when decoding the name and value of cookies
(which is in line with other implementations, such as PHP's cookie functions).</p>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #5</a> for more details.</p>
<h4>
<a id="invalid-request" class="anchor" href="#invalid-request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invalid request</h4>
<p>The <code>Server</code> and <code>StreamingServer</code> classes support both HTTP/1.1 and HTTP/1.0 request
messages. If a client sends an invalid request message, uses an invalid HTTP
protocol version or sends an invalid <code>Transfer-Encoding</code> request header value,
the server will automatically send a <code>400</code> (Bad Request) HTTP error response
to the client and close the connection.
On top of this, it will emit an <code>error</code> event that can be used for logging
purposes like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$e</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that the server will also emit an <code>error</code> event if you do not return a
valid response object from your request handler function. See also
<a href="#invalid-response">invalid response</a> for more details.</p>
<h3>
<a id="response" class="anchor" href="#response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response</h3>
<p>The callback function passed to the constructor of the <a href="#server"><code>Server</code></a> or
advanced <a href="#server"><code>StreamingServer</code></a> is responsible for processing the request
and returning a response, which will be delivered to the client.
This function MUST return an instance implementing
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#33-psrhttpmessageresponseinterface">PSR-7 ResponseInterface</a>
object or a
<a href="../promise/#reactpromise">ReactPHP Promise</a>
which will resolve a <code>PSR-7 ResponseInterface</code> object.</p>
<p>You will find a <code>Response</code> class
which implements the <code>PSR-7 ResponseInterface</code> in this project.
We use instantiation of this class in our projects,
but feel free to use any implemantation of the
<code>PSR-7 ResponseInterface</code> you prefer.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<h4>
<a id="deferred-response" class="anchor" href="#deferred-response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deferred response</h4>
<p>The example above returns the response directly, because it needs
no time to be processed.
Using a database, the file system or long calculations
(in fact every action that will take &gt;=1ms) to create your
response, will slow down the server.
To prevent this you SHOULD use a
<a href="../promise/#reactpromise">ReactPHP Promise</a>.
This example shows how such a long-term action could look like:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">$resolve</span>, <span class="pl-smi">$reject</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">1.5</span>, <span class="pl-k">function</span>() <span class="pl-k">use</span> (<span class="pl-smi">$resolve</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">200</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(</span>
<span class="pl-s1">                    <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">                ),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>Hello world<span class="pl-pds">"</span></span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will create a response after 1.5 second.
This example shows that you need a promise,
if your response needs time to created.
The <code>ReactPHP Promise</code> will resolve in a <code>Response</code> object when the request
body ends.
If the client closes the connection while the promise is still pending, the
promise will automatically be cancelled.
The promise cancellation handler can be used to clean up any pending resources
allocated in this case (if applicable).
If a promise is resolved after the client closes, it will simply be ignored.</p>
<h4>
<a id="streaming-response" class="anchor" href="#streaming-response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Streaming response</h4>
<p>The <code>Response</code> class in this project supports to add an instance which implements the
<a href="../stream/#readablestreaminterface">ReactPHP ReadableStreamInterface</a>
for the response body.
So you are able stream data directly into the response body.
Note that other implementations of the <code>PSR-7 ResponseInterface</code> likely
only support strings.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ThroughStream</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$timer</span> <span class="pl-k">=</span> <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addPeriodicTimer(<span class="pl-c1">0.5</span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>write(<span class="pl-c1">microtime</span>(<span class="pl-c1">true</span>) <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">5</span>, <span class="pl-k">function</span>() <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>, <span class="pl-smi">$timer</span>, <span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>cancelTimer(<span class="pl-smi">$timer</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>end();</span>
<span class="pl-s1">    });</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will emit every 0.5 seconds the current Unix timestamp
with microseconds as float to the client and will end after 5 seconds.
This is just a example you could use of the streaming,
you could also send a big amount of data via little chunks
or use it for body data that needs to calculated.</p>
<p>If the request handler resolves with a response stream that is already closed,
it will simply send an empty response body.
If the client closes the connection while the stream is still open, the
response stream will automatically be closed.
If a promise is resolved with a streaming body after the client closes, the
response stream will automatically be closed.
The <code>close</code> event can be used to clean up any pending resources allocated
in this case (if applicable).</p>
<blockquote>
<p>Note that special care has to be taken if you use a body stream instance that
implements ReactPHP's
<a href="../stream/#duplexstreaminterface"><code>DuplexStreamInterface</code></a>
(such as the <code>ThroughStream</code> in the above example).</p>
<p>For <em>most</em> cases, this will simply only consume its readable side and forward
(send) any data that is emitted by the stream, thus entirely ignoring the
writable side of the stream.
If however this is either a <code>101</code> (Switching Protocols) response or a <code>2xx</code>
(Successful) response to a <code>CONNECT</code> method, it will also <em>write</em> data to the
writable side of the stream.
This can be avoided by either rejecting all requests with the <code>CONNECT</code>
method (which is what most <em>normal</em> origin HTTP servers would likely do) or
or ensuring that only ever an instance of <code>ReadableStreamInterface</code> is
used.</p>
<p>The <code>101</code> (Switching Protocols) response code is useful for the more advanced
<code>Upgrade</code> requests, such as upgrading to the WebSocket protocol or
implementing custom protocol logic that is out of scope of the HTTP specs and
this HTTP library.
If you want to handle the <code>Upgrade: WebSocket</code> header, you will likely want
to look into using <a href="http://socketo.me/" rel="nofollow">Ratchet</a> instead.
If you want to handle a custom protocol, you will likely want to look into the
<a href="https://tools.ietf.org/html/rfc7230#section-6.7" rel="nofollow">HTTP specs</a> and also see
<a href="https://github.com/reactphp/http/blob/v0.8.5/examples">examples #31 and #32</a> for more details.
In particular, the <code>101</code> (Switching Protocols) response code MUST NOT be used
unless you send an <code>Upgrade</code> response header value that is also present in
the corresponding HTTP/1.1 <code>Upgrade</code> request header value.
The server automatically takes care of sending a <code>Connection: upgrade</code>
header value in this case, so you don't have to.</p>
<p>The <code>CONNECT</code> method is useful in a tunneling setup (HTTPS proxy) and not
something most origin HTTP servers would want to care about.
The HTTP specs define an opaque "tunneling mode" for this method and make no
use of the message body.
For consistency reasons, this library uses a <code>DuplexStreamInterface</code> in the
response body for tunneled application data.
This implies that that a <code>2xx</code> (Successful) response to a <code>CONNECT</code> request
can in fact use a streaming response body for the tunneled application data,
so that any raw data the client sends over the connection will be piped
through the writable stream for consumption.
Note that while the HTTP specs make no use of the request body for <code>CONNECT</code>
requests, one may still be present. Normal request body processing applies
here and the connection will only turn to "tunneling mode" after the request
body has been processed (which should be empty in most cases).
See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #22</a> for more details.</p>
</blockquote>
<h4>
<a id="response-length" class="anchor" href="#response-length" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response length</h4>
<p>If the response body size is known, a <code>Content-Length</code> response header will be
added automatically. This is the most common use case, for example when using
a <code>string</code> response body like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>If the response body size is unknown, a <code>Content-Length</code> response header can not
be added automatically. When using a <a href="#streaming-response">streaming response</a>
without an explicit <code>Content-Length</code> response header, outgoing HTTP/1.1 response
messages will automatically use <code>Transfer-Encoding: chunked</code> while legacy HTTP/1.0
response messages will contain the plain response body. If you know the length
of your streaming response body, you MAY want to specify it explicitly like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ThroughStream</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">2.0</span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>end(<span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Length<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>13<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Any response to a <code>HEAD</code> request and any response with a <code>1xx</code> (Informational),
<code>204</code> (No Content) or <code>304</code> (Not Modified) status code will <em>not</em> include a
message body as per the HTTP specs.
This means that your callback does not have to take special care of this and any
response body will simply be ignored.</p>
<p>Similarly, any <code>2xx</code> (Successful) response to a <code>CONNECT</code> request, any response
with a <code>1xx</code> (Informational) or <code>204</code> (No Content) status code will <em>not</em>
include a <code>Content-Length</code> or <code>Transfer-Encoding</code> header as these do not apply
to these messages.
Note that a response to a <code>HEAD</code> request and any response with a <code>304</code> (Not
Modified) status code MAY include these headers even though
the message does not contain a response body, because these header would apply
to the message if the same request would have used an (unconditional) <code>GET</code>.</p>
<h4>
<a id="invalid-response" class="anchor" href="#invalid-response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invalid response</h4>
<p>As stated above, each outgoing HTTP response is always represented by the
<a href="https://www.php-fig.org/psr/psr-7/#33-psrhttpmessageresponseinterface" rel="nofollow">PSR-7 <code>ResponseInterface</code></a>.
If your request handler function returns an invalid value or throws an
unhandled <code>Exception</code> or <code>Throwable</code>, the server will automatically send a <code>500</code>
(Internal Server Error) HTTP error response to the client.
On top of this, it will emit an <code>error</code> event that can be used for logging
purposes like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$e</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getPrevious() <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s1">        <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Previous: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getPrevious()<span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that the server will also emit an <code>error</code> event if the client sends an
invalid HTTP request that never reaches your request handler function. See
also <a href="#invalid-request">invalid request</a> for more details.
Additionally, a <a href="#streaming-request">streaming request</a> body can also emit
an <code>error</code> event on the request body.</p>
<p>The server will only send a very generic <code>500</code> (Interval Server Error) HTTP
error response without any further details to the client if an unhandled
error occurs. While we understand this might make initial debugging harder,
it also means that the server does not leak any application details or stack
traces to the outside by default. It is usually recommended to catch any
<code>Exception</code> or <code>Throwable</code> within your request handler function or alternatively
use a <a href="#middleware"><code>middleware</code></a> to avoid this generic error handling and
create your own HTTP response message instead.</p>
<h4>
<a id="default-response-headers" class="anchor" href="#default-response-headers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Default response headers</h4>
<p>After the return in the callback function the response will be processed by the
<a href="#server"><code>Server</code></a> or <a href="#streamingserver"><code>StreamingServer</code></a> respectively.
They will add the protocol version of the request, so you don't have to.</p>
<p>A <code>Date</code> header will be automatically added with the system date and time if none is given.
You can add a custom <code>Date</code> header yourself like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Date<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>D, d M Y H:i:s T<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>If you don't have a appropriate clock to rely on, you should
unset this header with an empty string:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Date<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that it will automatically assume a <code>X-Powered-By: react/alpha</code> header
unless your specify a custom <code>X-Powered-By</code> header yourself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>X-Powered-By<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PHP 3<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>If you do not want to send this header at all, you can use an empty string as
value like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>X-Powered-By<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span></span>
<span class="pl-s1">        )</span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that persistent connections (<code>Connection: keep-alive</code>) are currently
not supported.
As such, HTTP/1.1 response messages will automatically include a
<code>Connection: close</code> header, irrespective of what header values are
passed explicitly.</p>
<h3>
<a id="middleware" class="anchor" href="#middleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Middleware</h3>
<p>As documented above, the <a href="#server"><code>Server</code></a> and advanced
<a href="#streamingserver"><code>StreamingServer</code></a> accept a single
request handler argument that is responsible for processing an incoming
HTTP request and then creating and returning an outgoing HTTP response.</p>
<p>Many common use cases involve validating, processing, manipulating the incoming
HTTP request before passing it to the final business logic request handler.
As such, this project supports the concept of middleware request handlers.</p>
<p>A middleware request handler is expected to adhere the following rules:</p>
<ul>
<li>It is a valid <code>callable</code>.</li>
<li>It accepts <code>ServerRequestInterface</code> as first argument and an optional
<code>callable</code> as second argument.</li>
<li>It returns either:
<ul>
<li>An instance implementing <code>ResponseInterface</code> for direct consumption.</li>
<li>Any promise which can be consumed by
<a href="https://reactphp.org/promise/#resolve" rel="nofollow"><code>Promise\resolve()</code></a> resolving to a
<code>ResponseInterface</code> for deferred consumption.</li>
<li>It MAY throw an <code>Exception</code> (or return a rejected promise) in order to
signal an error condition and abort the chain.</li>
</ul>
</li>
<li>It calls <code>$next($request)</code> to continue processing the next middleware
request handler or returns explicitly without calling <code>$next</code> to
abort the chain.
<ul>
<li>The <code>$next</code> request handler (recursively) invokes the next request
handler from the chain with the same logic as above and returns (or throws)
as above.</li>
<li>The <code>$request</code> may be modified prior to calling <code>$next($request)</code> to
change the incoming request the next middleware operates on.</li>
<li>The <code>$next</code> return value may be consumed to modify the outgoing response.</li>
<li>The <code>$next</code> request handler MAY be called more than once if you want to
implement custom "retry" logic etc.</li>
</ul>
</li>
</ul>
<p>Note that this very simple definition allows you to use either anonymous
functions or any classes that use the magic <code>__invoke()</code> method.
This allows you to easily create custom middleware request handlers on the fly
or use a class based approach to ease using existing middleware implementations.</p>
<p>While this project does provide the means to <em>use</em> middleware implementations,
it does not aim to <em>define</em> how middleware implementations should look like.
We realize that there's a vivid ecosystem of middleware implementations and
ongoing effort to standardize interfaces between these with
<a href="https://www.php-fig.org/psr/psr-15/" rel="nofollow">PSR-15</a> (HTTP Server Request Handlers)
and support this goal.
As such, this project only bundles a few middleware implementations that are
required to match PHP's request behavior (see below) and otherwise actively
encourages <a href="#third-party-middleware">Third-Party Middleware</a> implementations.</p>
<p>In order to use middleware request handlers, simply pass an array with all
callables as defined above to the <a href="#server"><code>Server</code></a> or
<a href="#streamingserver"><code>StreamingServer</code></a> respectively.
The following example adds a middleware request handler that adds the current time to the request as a
header (<code>Request-Time</code>) and a final request handler that always returns a 200 code without a body:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>, <span class="pl-k">callable</span> <span class="pl-smi">$next</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$request</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>withHeader(<span class="pl-s"><span class="pl-pds">'</span>Request-Time<span class="pl-pds">'</span></span>, <span class="pl-c1">time</span>());</span>
<span class="pl-s1">        <span class="pl-k">return</span> $<span class="pl-smi">next</span>(<span class="pl-smi">$request</span>);</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">));</span></pre></div>
<blockquote>
<p>Note how the middleware request handler and the final request handler have a
very simple (and similar) interface. The only difference is that the final
request handler does not receive a <code>$next</code> handler.</p>
</blockquote>
<p>Similarly, you can use the result of the <code>$next</code> middleware request handler
function to modify the outgoing response.
Note that as per the above documentation, the <code>$next</code> middleware request handler may return a
<code>ResponseInterface</code> directly or one wrapped in a promise for deferred
resolution.
In order to simplify handling both paths, you can simply wrap this in a
<a href="https://reactphp.org/promise/#resolve" rel="nofollow"><code>Promise\resolve()</code></a> call like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>, <span class="pl-k">callable</span> <span class="pl-smi">$next</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$promise</span> <span class="pl-k">=</span> <span class="pl-c1">React\Promise\</span>resolve($<span class="pl-smi">next</span>(<span class="pl-smi">$request</span>));</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$promise</span><span class="pl-k">-&gt;</span>then(<span class="pl-k">function</span> (<span class="pl-c1">ResponseInterface</span> <span class="pl-smi">$response</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-smi">$response</span><span class="pl-k">-&gt;</span>withHeader(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">));</span></pre></div>
<p>Note that the <code>$next</code> middleware request handler may also throw an
<code>Exception</code> (or return a rejected promise) as described above.
The previous example does not catch any exceptions and would thus signal an
error condition to the <code>Server</code>.
Alternatively, you can also catch any <code>Exception</code> to implement custom error
handling logic (or logging etc.) by wrapping this in a
<a href="https://reactphp.org/promise/#promise" rel="nofollow"><code>Promise</code></a> like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>, <span class="pl-k">callable</span> <span class="pl-smi">$next</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$promise</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Promise\</span><span class="pl-c1">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">$resolve</span>) <span class="pl-k">use</span> (<span class="pl-smi">$next</span>, <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>($<span class="pl-smi">next</span>(<span class="pl-smi">$request</span>));</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-smi">$promise</span><span class="pl-k">-&gt;</span>then(<span class="pl-c1">null</span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$e</span>) {</span>
<span class="pl-s1">            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">500</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">'</span>Internal error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getMessage()</span>
<span class="pl-s1">            );</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-k">if</span> (<span class="pl-c1">mt_rand</span>(<span class="pl-c1">0</span>, <span class="pl-c1">1</span>) <span class="pl-k">===</span> <span class="pl-c1">1</span>) {</span>
<span class="pl-s1">            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-c1">RuntimeException</span>(<span class="pl-s"><span class="pl-pds">'</span>Database error<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">        }</span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">));</span></pre></div>
<h4>
<a id="limitconcurrentrequestsmiddleware" class="anchor" href="#limitconcurrentrequestsmiddleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LimitConcurrentRequestsMiddleware</h4>
<p>The <code>LimitConcurrentRequestsMiddleware</code> can be used to
limit how many next handlers can be executed concurrently.</p>
<p>If this middleware is invoked, it will check if the number of pending
handlers is below the allowed limit and then simply invoke the next handler
and it will return whatever the next handler returns (or throws).</p>
<p>If the number of pending handlers exceeds the allowed limit, the request will
be queued (and its streaming body will be paused) and it will return a pending
promise.
Once a pending handler returns (or throws), it will pick the oldest request
from this queue and invokes the next handler (and its streaming body will be
resumed).</p>
<p>The following example shows how this middleware can be used to ensure no more
than 10 handlers will be invoked at once:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">10</span>),</span>
<span class="pl-s1">    <span class="pl-smi">$handler</span></span>
<span class="pl-s1">));</span></pre></div>
<p>Similarly, this middleware is often used in combination with the
<a href="#requestbodybuffermiddleware"><code>RequestBodyBufferMiddleware</code></a> (see below)
to limit the total number of requests that can be buffered at once:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">100</span>), <span class="pl-c"><span class="pl-c">//</span> 100 concurrent buffering handlers</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyBufferMiddleware</span>(<span class="pl-c1">2</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>), <span class="pl-c"><span class="pl-c">//</span> 2 MiB per request</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyParserMiddleware</span>(),</span>
<span class="pl-s1">    <span class="pl-smi">$handler</span></span>
<span class="pl-s1">));</span></pre></div>
<p>More sophisticated examples include limiting the total number of requests
that can be buffered at once and then ensure the actual request handler only
processes one request after another without any concurrency:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">100</span>), <span class="pl-c"><span class="pl-c">//</span> 100 concurrent buffering handlers</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyBufferMiddleware</span>(<span class="pl-c1">2</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>), <span class="pl-c"><span class="pl-c">//</span> 2 MiB per request</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyParserMiddleware</span>(),</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">1</span>), <span class="pl-c"><span class="pl-c">//</span> only execute 1 handler (no concurrency)</span></span>
<span class="pl-s1">    <span class="pl-smi">$handler</span></span>
<span class="pl-s1">));</span></pre></div>
<h4>
<a id="requestbodybuffermiddleware" class="anchor" href="#requestbodybuffermiddleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RequestBodyBufferMiddleware</h4>
<p>One of the built-in middleware is the <code>RequestBodyBufferMiddleware</code> which
can be used to buffer the whole incoming request body in memory.
This can be useful if full PSR-7 compatibility is needed for the request handler
and the default streaming request body handling is not needed.
The constructor accepts one optional argument, the maximum request body size.
When one isn't provided it will use <code>post_max_size</code> (default 8 MiB) from PHP's
configuration.
(Note that the value from your matching SAPI will be used, which is the CLI
configuration in most cases.)</p>
<p>Any incoming request that has a request body that exceeds this limit will be
accepted, but its request body will be discarded (empty request body).
This is done in order to avoid having to keep an incoming request with an
excessive size (for example, think of a 2 GB file upload) in memory.
This allows the next middleware handler to still handle this request, but it
will see an empty request body.
This is similar to PHP's default behavior, where the body will not be parsed
if this limit is exceeded. However, unlike PHP's default behavior, the raw
request body is not available via <code>php://input</code>.</p>
<p>The <code>RequestBodyBufferMiddleware</code> will buffer requests with bodies of known size
(i.e. with <code>Content-Length</code> header specified) as well as requests with bodies of
unknown size (i.e. with <code>Transfer-Encoding: chunked</code> header).</p>
<p>All requests will be buffered in memory until the request body end has
been reached and then call the next middleware handler with the complete,
buffered request.
Similarly, this will immediately invoke the next middleware handler for requests
that have an empty request body (such as a simple <code>GET</code> request) and requests
that are already buffered (such as due to another middleware).</p>
<p>Note that the given buffer size limit is applied to each request individually.
This means that if you allow a 2 MiB limit and then receive 1000 concurrent
requests, up to 2000 MiB may be allocated for these buffers alone.
As such, it's highly recommended to use this along with the
<a href="#limitconcurrentrequestsmiddleware"><code>LimitConcurrentRequestsMiddleware</code></a> (see above) to limit
the total number of concurrent requests.</p>
<p>Usage:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">100</span>), <span class="pl-c"><span class="pl-c">//</span> 100 concurrent buffering handlers</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyBufferMiddleware</span>(<span class="pl-c1">16</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>), <span class="pl-c"><span class="pl-c">//</span> 16 MiB</span></span>
<span class="pl-s1">    <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> The body from $request-&gt;getBody() is now fully available without the need to stream it </span></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>);</span>
<span class="pl-s1">    },</span>
<span class="pl-s1">));</span></pre></div>
<h4>
<a id="requestbodyparsermiddleware" class="anchor" href="#requestbodyparsermiddleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RequestBodyParserMiddleware</h4>
<p>The <code>RequestBodyParserMiddleware</code> takes a fully buffered request body
(generally from <a href="#requestbodybuffermiddleware"><code>RequestBodyBufferMiddleware</code></a>),
and parses the form values and file uploads from the incoming HTTP request body.</p>
<p>This middleware handler takes care of applying values from HTTP
requests that use <code>Content-Type: application/x-www-form-urlencoded</code> or
<code>Content-Type: multipart/form-data</code> to resemble PHP's default superglobals
<code>$_POST</code> and <code>$_FILES</code>.
Instead of relying on these superglobals, you can use the
<code>$request-&gt;getParsedBody()</code> and <code>$request-&gt;getUploadedFiles()</code> methods
as defined by PSR-7.</p>
<p>Accordingly, each file upload will be represented as instance implementing <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#36-psrhttpmessageuploadedfileinterface"><code>UploadedFileInterface</code></a>.
Due to its blocking nature, the <code>moveTo()</code> method is not available and throws
a <code>RuntimeException</code> instead.
You can use <code>$contents = (string)$file-&gt;getStream();</code> to access the file
contents and persist this to your favorite data store.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$handler</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-c"><span class="pl-c">//</span> If any, parsed form fields are now available from $request-&gt;getParsedBody()</span></span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getParsedBody();</span>
<span class="pl-s1">    <span class="pl-smi">$name</span> <span class="pl-k">=</span> <span class="pl-c1">isset</span>(<span class="pl-smi">$body</span>[<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]) ? <span class="pl-smi">$body</span>[<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>] : <span class="pl-s"><span class="pl-pds">'</span>unnamed<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$files</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getUploadedFiles();</span>
<span class="pl-s1">    <span class="pl-smi">$avatar</span> <span class="pl-k">=</span> <span class="pl-c1">isset</span>(<span class="pl-smi">$files</span>[<span class="pl-s"><span class="pl-pds">'</span>avatar<span class="pl-pds">'</span></span>]) ? <span class="pl-smi">$files</span>[<span class="pl-s"><span class="pl-pds">'</span>avatar<span class="pl-pds">'</span></span>] : <span class="pl-c1">null</span>;</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$avatar</span> <span class="pl-k">instanceof</span> <span class="pl-c1">UploadedFileInterface</span>) {</span>
<span class="pl-s1">        <span class="pl-k">if</span> (<span class="pl-smi">$avatar</span><span class="pl-k">-&gt;</span>getError() <span class="pl-k">===</span> <span class="pl-c1">UPLOAD_ERR_OK</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$uploaded</span> <span class="pl-k">=</span> <span class="pl-smi">$avatar</span><span class="pl-k">-&gt;</span>getSize() <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span> bytes<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        } <span class="pl-k">elseif</span> (<span class="pl-smi">$avatar</span><span class="pl-k">-&gt;</span>getError() <span class="pl-k">===</span> <span class="pl-c1">UPLOAD_ERR_INI_SIZE</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$uploaded</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>file too large<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        } <span class="pl-k">else</span> {</span>
<span class="pl-s1">            <span class="pl-smi">$uploaded</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>with error<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    } <span class="pl-k">else</span> {</span>
<span class="pl-s1">        <span class="pl-smi">$uploaded</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>nothing<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span></span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$name</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span> uploaded <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$uploaded</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">};</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">StreamingServer</span>(<span class="pl-c1">array</span>((</span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">LimitConcurrentRequestsMiddleware</span>(<span class="pl-c1">100</span>), <span class="pl-c"><span class="pl-c">//</span> 100 concurrent buffering handlers</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyBufferMiddleware</span>(<span class="pl-c1">16</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>), <span class="pl-c"><span class="pl-c">//</span> 16 MiB</span></span>
<span class="pl-s1">    <span class="pl-k">new</span> <span class="pl-c1">RequestBodyParserMiddleware</span>(),</span>
<span class="pl-s1">    <span class="pl-smi">$handler</span></span>
<span class="pl-s1">));</span></pre></div>
<p>See also <a href="https://github.com/reactphp/http/blob/v0.8.5/examples">example #12</a> for more details.</p>
<p>By default, this middleware respects the
<a href="https://www.php.net/manual/en/ini.core.php#ini.upload-max-filesize" rel="nofollow"><code>upload_max_filesize</code></a>
(default <code>2M</code>) ini setting.
Files that exceed this limit will be rejected with an <code>UPLOAD_ERR_INI_SIZE</code> error.
You can control the maximum filesize for each individual file upload by
explicitly passing the maximum filesize in bytes as the first parameter to the
constructor like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">new</span> <span class="pl-c1">RequestBodyParserMiddleware</span>(<span class="pl-c1">8</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>); <span class="pl-c"><span class="pl-c">//</span> 8 MiB limit per file</span></span></pre></div>
<p>By default, this middleware respects the
<a href="https://www.php.net/manual/en/ini.core.php#ini.file-uploads" rel="nofollow"><code>file_uploads</code></a>
(default <code>1</code>) and
<a href="https://www.php.net/manual/en/ini.core.php#ini.max-file-uploads" rel="nofollow"><code>max_file_uploads</code></a>
(default <code>20</code>) ini settings.
These settings control if any and how many files can be uploaded in a single request.
If you upload more files in a single request, additional files will be ignored
and the <code>getUploadedFiles()</code> method returns a truncated array.
Note that upload fields left blank on submission do not count towards this limit.
You can control the maximum number of file uploads per request by explicitly
passing the second parameter to the constructor like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-k">new</span> <span class="pl-c1">RequestBodyParserMiddleware</span>(<span class="pl-c1">10</span> <span class="pl-k">*</span> <span class="pl-c1">1024</span>, <span class="pl-c1">100</span>); <span class="pl-c"><span class="pl-c">//</span> 100 files with 10 KiB each</span></span></pre></div>
<blockquote>
<p>Note that this middleware handler simply parses everything that is already
buffered in the request body.
It is imperative that the request body is buffered by a prior middleware
handler as given in the example above.
This previous middleware handler is also responsible for rejecting incoming
requests that exceed allowed message sizes (such as big file uploads).
The <a href="#requestbodybuffermiddleware"><code>RequestBodyBufferMiddleware</code></a> used above
simply discards excessive request bodies, resulting in an empty body.
If you use this middleware without buffering first, it will try to parse an
empty (streaming) body and may thus assume an empty data structure.
See also <a href="#requestbodybuffermiddleware"><code>RequestBodyBufferMiddleware</code></a> for
more details.</p>
</blockquote>
<blockquote>
<p>PHP's <code>MAX_FILE_SIZE</code> hidden field is respected by this middleware.
Files that exceed this limit will be rejected with an <code>UPLOAD_ERR_FORM_SIZE</code> error.</p>
</blockquote>
<blockquote>
<p>This middleware respects the
<a href="https://www.php.net/manual/en/info.configuration.php#ini.max-input-vars" rel="nofollow"><code>max_input_vars</code></a>
(default <code>1000</code>) and
<a href="https://www.php.net/manual/en/info.configuration.php#ini.max-input-nesting-level" rel="nofollow"><code>max_input_nesting_level</code></a>
(default <code>64</code>) ini settings.</p>
</blockquote>
<blockquote>
<p>Note that this middleware ignores the
<a href="https://www.php.net/manual/en/ini.core.php#ini.enable-post-data-reading" rel="nofollow"><code>enable_post_data_reading</code></a>
(default <code>1</code>) ini setting because it makes little sense to respect here and
is left up to higher-level implementations.
If you want to respect this setting, you have to check its value and
effectively avoid using this middleware entirely.</p>
</blockquote>
<h4>
<a id="third-party-middleware" class="anchor" href="#third-party-middleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Third-Party Middleware</h4>
<p>While this project does provide the means to <em>use</em> middleware implementations
(see above), it does not aim to <em>define</em> how middleware implementations should
look like. We realize that there's a vivid ecosystem of middleware
implementations and ongoing effort to standardize interfaces between these with
<a href="https://www.php-fig.org/psr/psr-15/" rel="nofollow">PSR-15</a> (HTTP Server Request Handlers)
and support this goal.
As such, this project only bundles a few middleware implementations that are
required to match PHP's request behavior (see above) and otherwise actively
encourages third-party middleware implementations.</p>
<p>While we would love to support PSR-15 directy in <code>react/http</code>, we understand
that this interface does not specifically target async APIs and as such does
not take advantage of promises for <a href="#deferred-response">deferred responses</a>.
The gist of this is that where PSR-15 enforces a <code>ResponseInterface</code> return
value, we also accept a <code>PromiseInterface&lt;ResponseInterface&gt;</code>.
As such, we suggest using the external
<a href="https://github.com/friends-of-reactphp/http-middleware-psr15-adapter">PSR-15 middleware adapter</a>
that uses on the fly monkey patching of these return values which makes using
most PSR-15 middleware possible with this package without any changes required.</p>
<p>Other than that, you can also use the above <a href="#middleware">middleware definition</a>
to create custom middleware. A non-exhaustive list of third-party middleware can
be found at the <a href="https://github.com/reactphp/http/wiki/Middleware">middleware wiki</a>.
If you build or know a custom middleware, make sure to let the world know and
feel free to add it to this list.</p>
<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>
<p>The recommended way to install this library is <a href="https://getcomposer.org" rel="nofollow">through Composer</a>.
<a href="https://getcomposer.org/doc/00-intro.md" rel="nofollow">New to Composer?</a></p>
<p>This will install the latest supported version:</p>
<div class="highlight highlight-source-shell"><pre>$ composer require react/http:^0.8.5</pre></div>
<p>See also the <a href="changelog.html">CHANGELOG</a> for details about version upgrades.</p>
<p>This project aims to run on any platform and thus does not require any PHP
extensions and supports running on legacy PHP 5.3 through current PHP 7+ and
HHVM.
It's <em>highly recommended to use PHP 7+</em> for this project.</p>
<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tests</h2>
<p>To run the test suite, you first need to clone this repo and then install all
dependencies <a href="https://getcomposer.org" rel="nofollow">through Composer</a>:</p>
<div class="highlight highlight-source-shell"><pre>$ composer install</pre></div>
<p>To run the test suite, go to the project root and run:</p>
<div class="highlight highlight-source-shell"><pre>$ php vendor/bin/phpunit</pre></div>
<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>
<p>MIT, see <a href="license.html">LICENSE file</a>.</p>
                                </main>
                <aside class="sidebar" role="complementary">
                    <section class="component-info">
                        <h2 class="component-info__title">
                            <a href="../http/">HTTP</a>

                            <div class="version-selector">
                                <button class="version-selector__button version-selector__button--latest" data-ctrly="component-version-selector" data-version-selector-control>
                                    v0.8.5

                                    <i class="icon-chevron-down" aria-hidden="true"></i>
                                    <i class="icon-chevron-up" aria-hidden="true"></i>
                                </button>

                                <div id="component-version-selector" class="version-selector__panel" aria-hidden="true">
                                    <p>Read the documentation of development and older versions on GitHub:</p>

                                    <ul class="version-selector__list">
                                        <li>
                                            <a href="https://github.com/reactphp/http#readme" class="version-selector__version version-selector__version--dev">
                                                master
                                            </a>
                                        </li>
                                                                                                                                                                                                                    <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.8.4#readme" class="version-selector__version">
                                                    v0.8.4
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.8.3#readme" class="version-selector__version">
                                                    v0.8.3
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.8.2#readme" class="version-selector__version">
                                                    v0.8.2
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.8.1#readme" class="version-selector__version">
                                                    v0.8.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.8.0#readme" class="version-selector__version">
                                                    v0.8.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.7.4#readme" class="version-selector__version">
                                                    v0.7.4
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.7.3#readme" class="version-selector__version">
                                                    v0.7.3
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.7.2#readme" class="version-selector__version">
                                                    v0.7.2
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.7.1#readme" class="version-selector__version">
                                                    v0.7.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.7.0#readme" class="version-selector__version">
                                                    v0.7.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.6.0#readme" class="version-selector__version">
                                                    v0.6.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.5.0#readme" class="version-selector__version">
                                                    v0.5.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.4.4#readme" class="version-selector__version">
                                                    v0.4.4
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.4.3#readme" class="version-selector__version">
                                                    v0.4.3
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.4.2#readme" class="version-selector__version">
                                                    v0.4.2
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.4.1#readme" class="version-selector__version">
                                                    v0.4.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.4.0#readme" class="version-selector__version">
                                                    v0.4.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.3.0#readme" class="version-selector__version">
                                                    v0.3.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.2.6#readme" class="version-selector__version">
                                                    v0.2.6
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.2.3#readme" class="version-selector__version">
                                                    v0.2.3
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.2.2#readme" class="version-selector__version">
                                                    v0.2.2
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.2.1#readme" class="version-selector__version">
                                                    v0.2.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.2.0#readme" class="version-selector__version">
                                                    v0.2.0
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.1.1#readme" class="version-selector__version">
                                                    v0.1.1
                                                </a>
                                            </li>
                                                                                                                                                                            <li>
                                                <a href="https://github.com/reactphp/http/tree/v0.1.0#readme" class="version-selector__version">
                                                    v0.1.0
                                                </a>
                                            </li>
                                                                                                                        </ul>
                                </div>
                            </div>
                        </h2>

                        <ul class="component-info__info">
                            <li>
                                <a href="https://github.com/reactphp/http">
                                    <i class="icon-github" aria-hidden="true"></i> Repository
                                </a>
                            </li>
                            <li>
                                <a href="../http/changelog.html">
                                    <i class="icon-calendar" aria-hidden="true"></i> Changelog
                                </a>
                            </li>
                            <li>
                                <a href="../http/license.html">
                                    <i class="icon-law" aria-hidden="true"></i> MIT License
                                </a>
                            </li>
                        </ul>

                        <h3 class="component-info__subtitle">Installation</h3>

                        <div class="highlight highlight-source-shell"><pre>composer require react/http:^0.8.5</pre></div>

                        <h3 class="component-info__subtitle">Contributors</h3>

                        <ul class="component-info__contributors">
                                                    <li>
                                <a href="https://github.com/clue">
                                    <img src="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=40" srcset="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=80 2x" alt="clue" title="clue (202 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/WyriHaximus">
                                    <img src="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=80 2x" alt="WyriHaximus" title="WyriHaximus (144 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/legionth">
                                    <img src="https://avatars0.githubusercontent.com/u/1578709?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/1578709?v=4&amp;s=80 2x" alt="legionth" title="legionth (43 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/jsor">
                                    <img src="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=80 2x" alt="jsor" title="jsor (41 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/igorw">
                                    <img src="https://avatars2.githubusercontent.com/u/88061?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/88061?v=4&amp;s=80 2x" alt="igorw" title="igorw (40 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/cboden">
                                    <img src="https://avatars0.githubusercontent.com/u/617694?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/617694?v=4&amp;s=80 2x" alt="cboden" title="cboden (30 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/arnaud-lb">
                                    <img src="https://avatars3.githubusercontent.com/u/365207?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/365207?v=4&amp;s=80 2x" alt="arnaud-lb" title="arnaud-lb (23 contributions)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/andig">
                                    <img src="https://avatars1.githubusercontent.com/u/184815?v=4&amp;s=40" srcset="https://avatars1.githubusercontent.com/u/184815?v=4&amp;s=80 2x" alt="andig" title="andig (8 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/onigoetz">
                                    <img src="https://avatars0.githubusercontent.com/u/309594?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/309594?v=4&amp;s=80 2x" alt="onigoetz" title="onigoetz (6 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/seregazhuk">
                                    <img src="https://avatars3.githubusercontent.com/u/9959761?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/9959761?v=4&amp;s=80 2x" alt="seregazhuk" title="seregazhuk (5 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/carusogabriel">
                                    <img src="https://avatars3.githubusercontent.com/u/16328050?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/16328050?v=4&amp;s=80 2x" alt="carusogabriel" title="carusogabriel (4 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/kalessil">
                                    <img src="https://avatars2.githubusercontent.com/u/1577185?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/1577185?v=4&amp;s=80 2x" alt="kalessil" title="kalessil (4 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/nopolabs">
                                    <img src="https://avatars2.githubusercontent.com/u/815864?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/815864?v=4&amp;s=80 2x" alt="nopolabs" title="nopolabs (3 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/slava-vishnyakov">
                                    <img src="https://avatars0.githubusercontent.com/u/817931?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/817931?v=4&amp;s=80 2x" alt="slava-vishnyakov" title="slava-vishnyakov (3 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/aaronbonneau">
                                    <img src="https://avatars0.githubusercontent.com/u/8574061?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/8574061?v=4&amp;s=80 2x" alt="aaronbonneau" title="aaronbonneau (2 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/iannsp">
                                    <img src="https://avatars2.githubusercontent.com/u/40551?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/40551?v=4&amp;s=80 2x" alt="iannsp" title="iannsp (2 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/beaucollins">
                                    <img src="https://avatars0.githubusercontent.com/u/19795?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/19795?v=4&amp;s=80 2x" alt="beaucollins" title="beaucollins (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/greevex">
                                    <img src="https://avatars3.githubusercontent.com/u/148401?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/148401?v=4&amp;s=80 2x" alt="greevex" title="greevex (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/marenzo">
                                    <img src="https://avatars3.githubusercontent.com/u/1208453?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/1208453?v=4&amp;s=80 2x" alt="marenzo" title="marenzo (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/PabloJoan">
                                    <img src="https://avatars0.githubusercontent.com/u/9193314?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/9193314?v=4&amp;s=80 2x" alt="PabloJoan" title="PabloJoan (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/ojhaujjwal">
                                    <img src="https://avatars3.githubusercontent.com/u/4995501?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/4995501?v=4&amp;s=80 2x" alt="ojhaujjwal" title="ojhaujjwal (1 contribution)">
                                </a>
                            </li>
                                                    <li>
                                <a href="https://github.com/e3betht">
                                    <img src="https://avatars0.githubusercontent.com/u/1811561?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/1811561?v=4&amp;s=80 2x" alt="e3betht" title="e3betht (1 contribution)">
                                </a>
                            </li>
                                                </ul>

                        <h3 class="component-info__subtitle">Activity</h3>

                        <div class="component-info__participation">
                            <svg width="320" height="42">
    <defs>
        <linearGradient id="reactphp-http-participation-gradient" x1="0" x2="0" y1="1" y2="0">
            <stop offset="10%" stop-color="#40a977"></stop>
            <stop offset="90%" stop-color="#ba3525"></stop>
        </linearGradient>
        <mask id="reactphp-http-participation-sparkline" x="0" y="0" width="320" height="40" >
            <polyline 
                transform="translate(0, 40) scale(1,-1)"
                points="0,1 6,4 12,2 18,1 24,1 30,1 36,1 42,1 48,1 54,1 60,2 66,1 72,1 78,1 84,1 90,1 96,1 102,1 108,1 114,1 120,1 126,2 132,1 138,6 144,3 150,1 156,1 162,1 168,1 174,1 180,1 186,1 192,6 198,1 204,1 210,1 216,1 222,1 228,1 234,1 240,2 246,1 252,1 258,1 264,1 270,1 276,1 282,2 288,1 294,1 300,1 306,3" 
                fill="transparent" 
                stroke="#40a977" 
                stroke-width="2"
            >
        </mask>
    </defs>

    <g transform="translate(0, -1.5)">
        <rect 
            x="0" 
            y="-2" 
            width="320" 
            height="42"
            style="stroke:none;fill:url(#reactphp-http-participation-gradient);mask:url(#reactphp-http-participation-sparkline)"
        ></rect>
    </g>
</svg>
                        </div>
                    </section>
                </aside>
            </div>
        </div>
    </div>

            <footer class="footer">
            <div class="wrapper">
                <ul class="links">
                    <li><a href="https://github.com/reactphp"><i class="icon-github" aria-hidden="true"></i> GitHub</a></li>
                    <li><a href="https://twitter.com/reactphp"><i class="icon-twitter" aria-hidden="true"></i> Twitter</a></li>
                    <li><a href="irc://irc.freenode.net/reactphp"><i class="icon-hash" aria-hidden="true"></i> IRC</a></li>
                </ul>
            </div>
        </footer>
        </body>
</html>
