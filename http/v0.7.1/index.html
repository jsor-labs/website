<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>HTTP: 
Http Component - ReactPHP</title>

        <meta name="description" content="Event-driven, streaming plaintext HTTP and secure HTTPS server for ReactPHP.">

        <link rel="apple-touch-icon" sizes="180x180" href="https://jsor-labs.github.io/website/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://jsor-labs.github.io/website/favicon-32x32.png">
        <link rel="manifest" href="https://jsor-labs.github.io/website/manifest.json">
        <link rel="mask-icon" href="https://jsor-labs.github.io/website/safari-pinned-tab.svg" color="#4f5b93">
        <meta name="apple-mobile-web-app-title" content="ReactPHP">
        <meta name="application-name" content="ReactPHP">
        <meta name="theme-color" content="#f4f3f1">
        <meta name="msapplication-config" content="https://jsor-labs.github.io/website/browserconfig.xml" />

        <meta property="og:image" content="https://jsor-labs.github.io/website/og-image.png">

            <script>window.__assets = '../../assets/';</script>

        <link rel="preload" href="../../assets/19ca4d35c8f94db0fa14422334dd2ad3.woff" as="font" type="font/woff" crossorigin>
        <link rel="preload" href="../../assets/be4ba3dd17008135675e945b630be8f6.woff" as="font" type="font/woff" crossorigin>

        <style>@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;font-display:swap;src:local("Source Sans Pro Regular"),local("SourceSansPro-Regular"),url(../../assets/19ca4d35c8f94db0fa14422334dd2ad3.woff) format("woff")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:700;font-display:swap;src:local("Source Sans Pro Bold"),local("SourceSansPro-Bold"),url(../../assets/be4ba3dd17008135675e945b630be8f6.woff) format("woff")}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.6;color:#584b4f;background-color:#fff}@media (max-width:768px){body{font-size:18px}}blockquote,fieldset,form,h1,h2,h3,h4,h5,h6,hr,ol,p,ul{margin:0 0 16px}ul{margin-bottom:0}hr{clear:both;height:0;border:0;border-bottom:1px dashed #eae8e3;padding:0}h1,h2,h3,h4,h5,h6{line-height:1;-webkit-font-smoothing:antialiased;color:#584b4f;font-family:Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-weight:700}h1{font-size:2.4em;margin-bottom:32px;color:#4f5b93;letter-spacing:-1px}h1:not(:first-child){margin-top:32px}h2{font-size:1.8em;margin-bottom:32px;color:#4f5b93}h2:not(:first-child){margin-top:32px}h3{font-size:1.4em;margin-bottom:24px}h3:not(:first-child){margin-top:24px}h4{font-size:1.2em;color:#4f5b93}h4:not(:first-child){margin-top:24px}@media (max-width:768px){h1{font-size:1.8em}h2{font-size:1.6em;margin-bottom:32px}}.container{padding:32px}@media (max-width:768px){.container{padding:16px}}.wrapper{max-width:960px;margin:auto}.wrapper--wide{max-width:1280px}.wrapper--narrow{max-width:640px}.main{width:calc(98% - 400px);margin-bottom:64px}.sidebar{width:calc(400px - 2%);margin-bottom:32px}@media (max-width:1024px){.main,.sidebar{width:auto}}.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px)}.grid{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:102%;margin-left:-2%}.grid>*{margin-left:2%;max-width:100%}.grid--4cols>*{-ms-flex-preferred-size:23%;flex-basis:23%}.grid--3cols>*{-ms-flex-preferred-size:31.33%;flex-basis:31.33%}.grid--2cols>*{-ms-flex-preferred-size:48%;flex-basis:48%}@media (max-width:768px){.grid{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.grid,.grid>*{width:100%;margin-left:0}.grid>*{-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}}.header{position:relative;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width:100%;background:#fefefe;box-shadow:0 1px 0 0 rgba(0,0,0,.08);padding:0 32px}@media (max-width:768px){.header{padding:0 16px;margin-bottom:16px}}.header__logo{display:block;line-height:1;padding:16px 0}.header__logo svg{display:block;width:120px;height:18px}.header__search{margin:0;position:absolute;right:80px;top:7px;z-index:999}@media (max-width:768px){.header__search{right:64px}}.header__search input{width:400px}@media (max-width:768px){.header__search input{width:calc(100vw - 80px)}}.header__menu{position:absolute;right:24px;top:0;z-index:800}@media (max-width:768px){.header__menu{right:8px}}.hamburger{visibility:hidden}.searchbox{width:100%}.searchbox,.searchbox:focus{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:6px 8px 6px 32px;font-size:16px;line-height:24px;color:#584b4f;border:0}.searchbox--collapsed:not(:focus){background-color:transparent;border:0;width:32px!important;margin-right:-12px}.welcome__intro{padding:16px 0 136px;border-bottom:1px dashed #eae8e3;background-image:radial-gradient(ellipse at center,#fff 0,#eae8e3 100%);background-size:auto 100%;background-position:50% 0}.welcome__intro h1{font-size:2em;margin-bottom:16px;color:#4f5b93}.welcome__logo{display:block;margin:0 auto;max-width:320px}.welcome__logo svg{display:block;height:240px}.welcome__content{padding-top:16px;display:block;max-width:calc(98% - 320px)}.welcome__example{display:block;margin:auto;max-width:800px;margin-top:-160px}.welcome__example .highlight pre{padding:32px;background:#fff;box-shadow:0 0 16px #d6d1c8}.welcome__intro .links a{color:#584b4f;text-decoration:none}.welcome__intro .links a:hover{color:#4f5b93;text-decoration:none}@media (max-width:768px){.welcome__content{padding:32px 16px 16px;max-width:100%}.welcome__logo svg{height:160px}.welcome__intro h1{text-align:center;font-size:1.6em;margin-bottom:16px;color:#4f5b93}.welcome__intro .links{text-align:center}}code,pre,tt{font-family:Consolas,Liberation Mono,Menlo,Courier,monospace}code,tt{font-size:.75em}pre{font-size:.85em;line-height:1.45}@media (max-width:768px){pre{font-size:.75em}}.links{margin:0;padding:0}.links li{display:inline-block;margin:0 8px;text-decoration:none}.links li:first-child{margin-left:0}.links li:last-child{margin-right:0}.links a{display:block}.links a,.links a:hover{text-decoration:none}.off-canvas-menu{position:fixed;top:0;right:0;-webkit-transform:translate3d(calc(100% + 5px),0,0);transform:translate3d(calc(100% + 5px),0,0)}.component-info__contributors,.component-info__title{display:-webkit-box;display:-ms-flexbox;display:flex}.component-info__contributors{-ms-flex-wrap:wrap;flex-wrap:wrap;padding:0;list-style:none}.component-info__contributors img{display:block;width:40px;height:auto}.version-selector__panel{position:fixed;top:-20000em;visibility:hidden}</style>
        <link rel="preload" href="../../assets/main.89f52cb36b2ecce568ca.css" as="style" onload="this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="../../assets/main.89f52cb36b2ecce568ca.css"></noscript>

        <script>!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,n){n.p=window.__assets},,,,,function(e,t,n){n(0),e.exports=n(6)},function(e,t,n){n(7),n(8),n(10),n(11),n(13),n(15)},function(e,t,n){"use strict";function r(e){try{return(e||window).document.createElement("link").relList.supports("preload")}catch(e){return!1}}function o(e){function t(){for(var e=r.querySelectorAll('link[rel="preload"][as="style"]'),t=0;t<e.length;t++){var n,o;!function(){function i(){o.media=n.getAttribute("media")||"all",o.removeEventListener("load",i)}n=e[t],n.rel="",o=r.createElement("link"),o.rel="stylesheet",o.href=n.href,o.media="only x",o.addEventListener("load",i),n.parentNode.insertBefore(o,n.nextSibling||n)}()}}var n=e||window,r=n.document;if(t(),"complete"!==r.readyState){var o=n.setInterval(t,300);n.addEventListener("load",function(){t(),n.clearInterval(o)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.supports=r,t.polyfill=o,r()||o()},function(e,t){},,function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12);n.n(r)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14);n.n(r)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);n.n(r)},function(e,t){}]);</script>
            </head>

    <body>
            <header class="header">
            <a class="header__logo" href="../../">
                <svg xmlns="http://www.w3.org/2000/svg" width="320" height="47.29" viewBox="0 428.964 320 47.29"><path fill="#584B4F" d="M30.86 452.385c1.637-2.287 2.455-5 2.455-8.134 0-4.313-1.367-7.87-4.088-10.68-2.723-2.812-6.39-4.216-11.004-4.216h-7.71c-3.79 0-6.49.798-8.1 2.388C.806 433.332 0 435.872 0 439.355v36.512h9.08v-17.245h6.53l9.08 17.245h10.52L24.82 457.12c2.395-.87 4.41-2.447 6.04-4.735zm-8.488-3.334c-1.24 1.33-2.82 1.99-4.734 1.99H9.08v-9.47c0-2.74 1.35-4.112 4.05-4.112h4.508c2 0 3.603.61 4.8 1.83 1.196 1.22 1.797 2.82 1.797 4.802 0 1.982-.623 3.64-1.864 4.964v-.003zm20.348 14.536c0 4.572 1.055 7.766 3.167 9.57 2.114 1.81 5.782 2.71 11.008 2.71h16.46v-8.1H57.548c-2.18 0-3.68-.35-4.51-1.045-.83-.695-1.24-1.96-1.24-3.788v-6.467h14.434l.656-8.1h-15.09v-10.912h21.56v-8.098H42.72v34.23zm57.97-33.442c-.718-.523-1.665-.787-2.84-.787-1.177 0-2.168.285-2.972.85-.807.567-1.537 1.592-2.19 3.073l-14.89 42.585h9.47l2.55-8.03h15.613l2.613 8.03h9.47l-14.893-42.588c-.567-1.572-1.21-2.613-1.93-3.135v.002zM92.1 460.19l5.75-18.42 5.487 18.418H92.1v.002zm53.074 5.455c-1.155 1.678-3.245 2.512-6.27 2.512-3.03 0-5.258-.914-6.697-2.74-1.394-1.83-2.093-5.25-2.093-10.256v-4.052c0-1.783.045-3.2.13-4.243.178-3.27.785-5.576 1.833-6.928 1.48-1.914 3.745-2.873 6.794-2.873 2.613 0 4.532.653 5.75 1.96 1.218 1.308 2.07 3.245 2.547 5.813h8.49c0-5.14-1.557-9.07-4.67-11.79-3.114-2.723-7.153-4.084-12.116-4.084-3.398 0-6.293.564-8.687 1.7-6.097 2.783-9.146 9.686-9.146 20.704v3.918c0 13.982 5.945 20.968 17.833 20.968 5.4 0 9.58-1.59 12.54-4.77 2.964-3.176 4.44-7.73 4.44-13.653h-8.426c-.346 3.53-1.1 6.134-2.25 7.81v.005zm14.667-36.29v8.1h12.412v38.41h9.08v-38.41h12.47v-8.1"/><path fill="#4F5B93" d="M218.89 429.356h-18.03v46.51h9.086v-14.897h8.944c4.876 0 8.647-1.337 11.328-4.016 2.683-2.68 4.02-6.608 4.02-11.788s-1.337-9.112-4.02-11.788c-2.68-2.68-6.454-4.02-11.328-4.02v-.002zm4.538 21.686c-1.15 1.177-2.815 1.768-5 1.768h-8.485v-15.354h8.484c4.483 0 6.73 2.572 6.73 7.71 0 2.744-.578 4.703-1.73 5.88v-.004zm43.93-2.02H250.31v-19.666h-9.088v46.51h9.086v-18.81h17.05v18.81h9.076v-46.51h-9.078m48.63 4.02c-2.683-2.68-6.46-4.02-11.335-4.02h-18.027v46.507h9.085V460.97h8.943c4.877 0 8.654-1.336 11.337-4.014 2.68-2.678 4.013-6.608 4.013-11.788s-1.332-9.112-4.013-11.79v-.003zm-6.795 17.666c-1.154 1.177-2.822 1.768-5 1.768h-8.484v-15.354h8.485c4.483 0 6.734 2.572 6.734 7.71 0 2.744-.583 4.703-1.735 5.88v-.004z"/></svg>
            </a>
            <form class="header__search">
                <input type="search" class="searchbox searchbox--collapsed" data-docsearch placeholder="Search documentation...">
            </form>
            <div class="header__menu">
                <button class="hamburger" aria-expanded="false" aria-controls="off-canvas-menu" data-off-canvas-menu-toggle>
                    <div class="hamburger__box">
                        <div class="hamburger__inner">
                            <span class="visually-hidden">Menu</span>
                        </div>
                    </div>
                </button>
            </div>
            <nav id="off-canvas-menu" class="off-canvas-menu" aria-hidden="true">
                <button aria-label="Close menu" class="off-canvas-menu__close" aria-expanded="false" aria-controls="off-canvas-menu" data-off-canvas-menu-toggle>
                    <i class="icon-x" aria-hidden="true"></i>
                </button>
                <div class="off-canvas-menu__content">
                    <section class="off-canvas-menu__section">
                        <a class="off-canvas-menu__section-top" href="../../">Home</a>
                    </section>
                    <section class="off-canvas-menu__section">
                        <h3 class="off-canvas-menu__section-header">Components</h3>
                        <ul class="off-canvas-menu__list">
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../event-loop/">
                                    EventLoop

                                    <span class="off-canvas-menu__version">
                                        v0.4.3
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../stream/">
                                    Stream

                                    <span class="off-canvas-menu__version">
                                        v0.7.3
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../promise/">
                                    Promise

                                    <span class="off-canvas-menu__version">
                                        v2.5.1
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../socket/">
                                    Socket

                                    <span class="off-canvas-menu__version">
                                        v0.8.4
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../datagram/">
                                    Datagram

                                    <span class="off-canvas-menu__version">
                                        v1.3.0
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../http/">
                                    HTTP

                                    <span class="off-canvas-menu__version">
                                        v0.7.4
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../http-client/">
                                    HTTPClient

                                    <span class="off-canvas-menu__version">
                                        v0.5.6
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../dns/">
                                    DNS

                                    <span class="off-canvas-menu__version">
                                        v0.4.11
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../cache/">
                                    Cache

                                    <span class="off-canvas-menu__version">
                                        v0.4.1
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../promise-timer/">
                                    PromiseTimer

                                    <span class="off-canvas-menu__version">
                                        v1.2.0
                                    </span>
                                </a>
                            </li>
                                                    <li>
                                <a class="off-canvas-menu__link" href="../../child-process/">
                                    ChildProcess

                                    <span class="off-canvas-menu__version">
                                        v0.5.0
                                    </span>
                                </a>
                            </li>
                                                </ul>
                    </section>
                </div>
            </nav>
        </header>
    
        <div class="container">
        <div class="grid grid--wrap grid--gutter">
            <main class="main">
                                    <p class="alert">
                        You are browsing the documentation for <strong>HTTP <code>v0.7.1</code></strong> which is an older version.
                        <a href="../../http/v0.7.4/">Go to the latest stable version <strong>v0.7.4</strong>.</a>
                    </p>
                
                <h1>
<a id="http-component" class="anchor" href="#http-component" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Http Component</h1>
<p><a href="http://travis-ci.org/reactphp/http"><img src="https://camo.githubusercontent.com/ed8b51bcc22521f51d52e5ae94577adcb01d1c3e/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f72656163747068702f687474702e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://secure.travis-ci.org/reactphp/http.png?branch=master" style="max-width:100%;"></a> <a href="https://codeclimate.com/github/reactphp/http"><img src="https://camo.githubusercontent.com/99c4147f230b6759b62367fe73ea50df026ce9cc/68747470733a2f2f636f6465636c696d6174652e636f6d2f6769746875622f72656163747068702f687474702f6261646765732f6770612e737667" alt="Code Climate" data-canonical-src="https://codeclimate.com/github/reactphp/http/badges/gpa.svg" style="max-width:100%;"></a></p>
<p>Event-driven, streaming plaintext HTTP and secure HTTPS server for <a href="https://reactphp.org/">ReactPHP</a></p>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#quickstart-example">Quickstart example</a></li>
<li>
<a href="#usage">Usage</a>
<ul>
<li><a href="#server">Server</a></li>
<li><a href="#request">Request</a></li>
<li><a href="#response">Response</a></li>
</ul>
</li>
<li><a href="#install">Install</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#license">License</a></li>
</ul>
<h2>
<a id="quickstart-example" class="anchor" href="#quickstart-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Quickstart example</h2>
<p>This is an HTTP server which responds with <code>Hello World</code> to every request.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$loop</span> <span class="pl-k">=</span> <span class="pl-c1">React\EventLoop\</span><span class="pl-c1">Factory</span><span class="pl-k">::</span>create();</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-c1">8080</span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>run();</span></pre></div>
<p>See also the <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">examples</a>.</p>
<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>
<h3>
<a id="server" class="anchor" href="#server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Server</h3>
<p>The <code>Server</code> class is responsible for handling incoming connections and then
processing each incoming HTTP request.</p>
<p>For each request, it executes the callback function passed to the
constructor with the respective <a href="#request">request</a> object and expects
a respective <a href="#response">response</a> object in return.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>In order to process any connections, the server needs to be attached to an
instance of <code>React\Socket\ServerInterface</code> which emits underlying streaming
connections in order to then parse incoming data as HTTP.</p>
<p>You can attach this to a
<a href="https://github.com/reactphp/socket#server"><code>React\Socket\Server</code></a>
in order to start a plaintext HTTP server like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-c1">8080</span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>See also the <code>listen()</code> method and the <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">first example</a> for more details.</p>
<p>Similarly, you can also attach this to a
<a href="https://github.com/reactphp/socket#secureserver"><code>React\Socket\SecureServer</code></a>
in order to start a secure HTTPS server like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-smi">$handler</span>);</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">Server</span>(<span class="pl-c1">8080</span>, <span class="pl-smi">$loop</span>);</span>
<span class="pl-s1"><span class="pl-smi">$socket</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">React\Socket\</span><span class="pl-c1">SecureServer</span>(<span class="pl-smi">$socket</span>, <span class="pl-smi">$loop</span>, <span class="pl-c1">array</span>(</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>local_cert<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">__DIR__</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>/localhost.pem<span class="pl-pds">'</span></span></span>
<span class="pl-s1">));</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>listen(<span class="pl-smi">$socket</span>);</span></pre></div>
<p>See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #11</a> for more details.</p>
<p>When HTTP/1.1 clients want to send a bigger request body, they MAY send only
the request headers with an additional <code>Expect: 100-continue</code> header and
wait before sending the actual (large) message body.
In this case the server will automatically send an intermediary
<code>HTTP/1.1 100 Continue</code> response to the client.
This ensures you will receive the request body without a delay as expected.
The <a href="#response">Response</a> still needs to be created as described in the
examples above.</p>
<p>See also <a href="#request">request</a> and <a href="#response">response</a>
for more details (e.g. the request data body).</p>
<p>The <code>Server</code> supports both HTTP/1.1 and HTTP/1.0 request messages.
If a client sends an invalid request message, uses an invalid HTTP protocol
version or sends an invalid <code>Transfer-Encoding</code> in the request header, it will
emit an <code>error</code> event, send an HTTP error response to the client and
close the connection:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$e</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">});</span></pre></div>
<p>The server will also emit an <code>error</code> event if you return an invalid
type in the callback function or have a unhandled <code>Exception</code>.
If your callback function throws an exception,
the <code>Server</code> will emit a <code>RuntimeException</code> and add the thrown exception
as previous:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span><span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">Exception</span> <span class="pl-smi">$e</span>) {</span>
<span class="pl-s1">    <span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">'</span>Error: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getPrevious() <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$previousException</span> <span class="pl-k">=</span> <span class="pl-smi">$e</span><span class="pl-k">-&gt;</span>getPrevious();</span>
<span class="pl-s1">        <span class="pl-c1">echo</span> <span class="pl-smi">$previousException</span><span class="pl-k">-&gt;</span>getMessage() <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>;</span>
<span class="pl-s1">    }</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that the request object can also emit an error.
Check out <a href="#request">request</a> for more details.</p>
<h3>
<a id="request" class="anchor" href="#request" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request</h3>
<p>An seen above, the <code>Server</code> class is responsible for handling incoming
connections and then processing each incoming HTTP request.</p>
<p>The request object will be processed once the request headers have
been received by the client.
This request object implements the
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#321-psrhttpmessageserverrequestinterface">PSR-7 ServerRequestInterface</a>
which in turn extends the
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#32-psrhttpmessagerequestinterface">PSR-7 RequestInterface</a>
and will be passed to the callback function like this.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">   <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>The method of the request is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getMethod();</span>
<span class="pl-s1">   <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">"</span>The requested path is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getUri()<span class="pl-k">-&gt;</span>getPath();</span>
<span class="pl-s1"></span>
<span class="pl-s1">   <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">       <span class="pl-c1">200</span>,</span>
<span class="pl-s1">       <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">       <span class="pl-smi">$body</span></span>
<span class="pl-s1">   );</span>
<span class="pl-s1">});</span></pre></div>
<p>The <code>getServerParams(): mixed[]</code> method can be used to
get server-side parameters similar to the <code>$_SERVER</code> variable.
The following parameters are currently available:</p>
<ul>
<li>
<code>REMOTE_ADDR</code>
The IP address of the request sender</li>
<li>
<code>REMOTE_PORT</code>
Port of the request sender</li>
<li>
<code>SERVER_ADDR</code>
The IP address of the server</li>
<li>
<code>SERVER_PORT</code>
The port of the server</li>
<li>
<code>REQUEST_TIME</code>
Unix timestamp when the complete request header has been received,
as integer similar to <code>time()</code>
</li>
<li>
<code>REQUEST_TIME_FLOAT</code>
Unix timestamp when the complete request header has been received,
as float similar to <code>microtime(true)</code>
</li>
<li>
<code>HTTPS</code>
Set to 'on' if the request used HTTPS, otherwise it won't be set</li>
</ul>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Your IP is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getServerParams()[<span class="pl-s"><span class="pl-pds">'</span>REMOTE_ADDR<span class="pl-pds">'</span></span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$body</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #2</a>.</p>
<p>The <code>getQueryParams(): array</code> method can be used to get the query parameters
similiar to the <code>$_GET</code> variable.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$queryParams</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getQueryParams();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The query parameter "foo" is not set. Click the following link <span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">    <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">'</span>&lt;a href="/?foo=bar"&gt;to use query parameter in your request&lt;/a&gt;<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-c1">isset</span>(<span class="pl-smi">$queryParams</span>[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>])) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The value of "foo" is: <span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">htmlspecialchars</span>(<span class="pl-smi">$queryParams</span>[<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>]);</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/html<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-smi">$body</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The response in the above example will return a response body with a link.
The URL contains the query parameter <code>foo</code> with the value <code>bar</code>.
Use <a href="http://php.net/manual/en/function.htmlentities.php"><code>htmlentities</code></a>
like in this example to prevent
<a href="https://en.wikipedia.org/wiki/Cross-site_scripting">Cross-Site Scripting (abbreviated as XSS)</a>.</p>
<p>See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #3</a>.</p>
<p>For more details about the request object, check out the documentation of
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#321-psrhttpmessageserverrequestinterface">PSR-7 ServerRequestInterface</a>
and
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#32-psrhttpmessagerequestinterface">PSR-7 RequestInterface</a>.</p>
<blockquote>
<p>Currently the uploaded files are not added by the
<code>Server</code>, but you can add these parameters by yourself using the given methods.
The next versions of this project will cover these features.</p>
</blockquote>
<p>Note that the request object will be processed once the request headers have
been received.
This means that this happens irrespective of (i.e. <em>before</em>) receiving the
(potentially much larger) request body.
While this may be uncommon in the PHP ecosystem, this is actually a very powerful
approach that gives you several advantages not otherwise possible:</p>
<ul>
<li>React to requests <em>before</em> receiving a large request body,
such as rejecting an unauthenticated request or one that exceeds allowed
message lengths (file uploads).</li>
<li>Start processing parts of the request body before the remainder of the request
body arrives or if the sender is slowly streaming data.</li>
<li>Process a large request body without having to buffer anything in memory,
such as accepting a huge file upload or possibly unlimited request body stream.</li>
</ul>
<p>The <code>getBody()</code> method can be used to access the request body stream.
This method returns a stream instance that implements both the
<a href="http://www.php-fig.org/psr/psr-7/#psrhttpmessagestreaminterface">PSR-7 StreamInterface</a>
and the <a href="https://github.com/reactphp/stream#readablestreaminterface">ReactPHP ReadableStreamInterface</a>.
However, most of the <code>PSR-7 StreamInterface</code> methods have been
designed under the assumption of being in control of the request body.
Given that this does not apply to this server, the following
<code>PSR-7 StreamInterface</code> methods are not used and SHOULD NOT be called:
<code>tell()</code>, <code>eof()</code>, <code>seek()</code>, <code>rewind()</code>, <code>write()</code> and <code>read()</code>.
Instead, you should use the <code>ReactPHP ReadableStreamInterface</code> which
gives you access to the incoming request body as the individual chunks arrive:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">$resolve</span>, <span class="pl-smi">$reject</span>) <span class="pl-k">use</span> (<span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$contentLength</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;</span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$data</span>) <span class="pl-k">use</span> (<span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$contentLength</span> <span class="pl-k">+</span><span class="pl-k">=</span> <span class="pl-c1">strlen</span>(<span class="pl-smi">$data</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$resolve</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>){</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">200</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>The length of the submitted request body is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$contentLength</span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-c"><span class="pl-c">//</span> an error occures e.g. on invalid chunked encoded data or an unexpected 'end' event</span></span>
<span class="pl-s1">        <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>on(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-c1">\Exception</span> <span class="pl-smi">$exception</span>) <span class="pl-k">use</span> (<span class="pl-smi">$resolve</span>, <span class="pl-k">&amp;</span><span class="pl-smi">$contentLength</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">400</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>An error occured while reading at length: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$contentLength</span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example simply counts the number of bytes received in the request body.
This can be used as a skeleton for buffering or processing the request body.</p>
<p>See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #4</a> for more details.</p>
<p>The <code>data</code> event will be emitted whenever new data is available on the request
body stream.
The server automatically takes care of decoding chunked transfer encoding
and will only emit the actual payload as data.
In this case, the <code>Transfer-Encoding</code> header will be removed.</p>
<p>The <code>end</code> event will be emitted when the request body stream terminates
successfully, i.e. it was read until its expected end.</p>
<p>The <code>error</code> event will be emitted in case the request stream contains invalid
chunked data or the connection closes before the complete request stream has
been received.
The server will automatically <code>pause()</code> the connection instead of closing it.
A response message can still be sent (unless the connection is already closed).</p>
<p>A <code>close</code> event will be emitted after an <code>error</code> or <code>end</code> event.</p>
<p>For more details about the request body stream, check out the documentation of
<a href="https://github.com/reactphp/stream#readablestreaminterface">ReactPHP ReadableStreamInterface</a>.</p>
<p>The <code>getSize(): ?int</code> method can be used if you only want to know the request
body size.
This method returns the complete size of the request body as defined by the
message boundaries.
This value may be <code>0</code> if the request message does not contain a request body
(such as a simple <code>GET</code> request).
Note that this value may be <code>null</code> if the request body size is unknown in
advance because the request message uses chunked transfer encoding.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$size</span> <span class="pl-k">=</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getBody()<span class="pl-k">-&gt;</span>getSize();</span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-smi">$size</span> <span class="pl-k">===</span> <span class="pl-c1">null</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>The request does not contain an explicit length.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">.=</span> <span class="pl-s"><span class="pl-pds">'</span>This server does not accept chunked transfer encoding.<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">            <span class="pl-c1">411</span>,</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">            <span class="pl-smi">$body</span></span>
<span class="pl-s1">        );</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Request body size: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$size</span> <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">"</span> bytes<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that the server supports <em>any</em> request method (including custom and non-
standard ones) and all request-target formats defined in the HTTP specs for each
respective method, including <em>normal</em> <code>origin-form</code> requests as well as
proxy requests in <code>absolute-form</code> and <code>authority-form</code>.
The <code>getUri(): UriInterface</code> method can be used to get the effective request
URI which provides you access to individiual URI components.
Note that (depending on the given <code>request-target</code>) certain URI components may
or may not be present, for example the <code>getPath(): string</code> method will return
an empty string for requests in <code>asterisk-form</code> or <code>authority-form</code>.
Its <code>getHost(): string</code> method will return the host as determined by the
effective request URI, which defaults to the local socket address if a HTTP/1.0
client did not specify one (i.e. no <code>Host</code> header).
Its <code>getScheme(): string</code> method will return <code>http</code> or <code>https</code> depending
on whether the request was made over a secure TLS connection to the target host.</p>
<p>The <code>Host</code> header value will be sanitized to match this host component plus the
port component only if it is non-standard for this URI scheme.</p>
<p>You can use <code>getMethod(): string</code> and <code>getRequestTarget(): string</code> to
check this is an accepted request and may want to reject other requests with
an appropriate error code, such as <code>400</code> (Bad Request) or <code>405</code> (Method Not
Allowed).</p>
<blockquote>
<p>The <code>CONNECT</code> method is useful in a tunneling setup (HTTPS proxy) and not
something most HTTP servers would want to care about.
Note that if you want to handle this method, the client MAY send a different
request-target than the <code>Host</code> header value (such as removing default ports)
and the request-target MUST take precendence when forwarding.</p>
</blockquote>
<p>The <code>getCookieParams(): string[]</code> method can be used to
get all cookies sent with the current request.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$key</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>react\php<span class="pl-pds">'</span></span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">if</span> (<span class="pl-c1">isset</span>(<span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getCookieParams()[<span class="pl-smi">$key</span>])) {</span>
<span class="pl-s1">        <span class="pl-smi">$body</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Your cookie value is: <span class="pl-pds">"</span></span> <span class="pl-k">.</span> <span class="pl-smi">$request</span><span class="pl-k">-&gt;</span>getCookieParams()[<span class="pl-smi">$key</span>];</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">            <span class="pl-c1">200</span>,</span>
<span class="pl-s1">            <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">            <span class="pl-smi">$body</span></span>
<span class="pl-s1">        );</span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Set-Cookie<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">urlencode</span>(<span class="pl-smi">$key</span>) <span class="pl-k">.</span> <span class="pl-s"><span class="pl-pds">'</span>=<span class="pl-pds">'</span></span> <span class="pl-k">.</span> <span class="pl-c1">urlencode</span>(<span class="pl-s"><span class="pl-pds">'</span>test;more<span class="pl-pds">'</span></span>)</span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Your cookie has been set.<span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will try to set a cookie on first access and
will try to print the cookie value on all subsequent tries.
Note how the example uses the <code>urlencode()</code> function to encode
non-alphanumeric characters.
This encoding is also used internally when decoding the name and value of cookies
(which is in line with other implementations, such as PHP's cookie functions).</p>
<p>See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #6</a> for more details.</p>
<h3>
<a id="response" class="anchor" href="#response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response</h3>
<p>The callback function passed to the constructor of the <a href="#server">Server</a>
is responsible for processing the request and returning a response,
which will be delivered to the client.
This function MUST return an instance imlementing
<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-7-http-message.md#33-psrhttpmessageresponseinterface">PSR-7 ResponseInterface</a>
object or a
<a href="https://github.com/reactphp/promise#reactpromise">ReactPHP Promise</a>
which will resolve a <code>PSR-7 ResponseInterface</code> object.</p>
<p>You will find a <code>Response</code> class
which implements the <code>PSR-7 ResponseInterface</code> in this project.
We use instantiation of this class in our projects,
but feel free to use any implemantation of the
<code>PSR-7 ResponseInterface</code> you prefer.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">"</span>Hello World!<span class="pl-cce">\n</span><span class="pl-pds">"</span></span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>The example above returns the response directly, because it needs
no time to be processed.
Using a database, the file system or long calculations
(in fact every action that will take &gt;=1ms) to create your
response, will slow down the server.
To prevent this you SHOULD use a
<a href="https://github.com/reactphp/promise#reactpromise">ReactPHP Promise</a>.
This example shows how such a long-term action could look like:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Promise</span>(<span class="pl-k">function</span> (<span class="pl-smi">$resolve</span>, <span class="pl-smi">$reject</span>) <span class="pl-k">use</span> (<span class="pl-smi">$request</span>, <span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">1.5</span>, <span class="pl-k">function</span>() <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>, <span class="pl-smi">$resolve</span>) {</span>
<span class="pl-s1">            <span class="pl-smi">$response</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">                <span class="pl-c1">200</span>,</span>
<span class="pl-s1">                <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>),</span>
<span class="pl-s1">                <span class="pl-s"><span class="pl-pds">"</span>Hello world<span class="pl-pds">"</span></span></span>
<span class="pl-s1">            );</span>
<span class="pl-s1">            $<span class="pl-smi">resolve</span>(<span class="pl-smi">$response</span>);</span>
<span class="pl-s1">        });</span>
<span class="pl-s1">    });</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will create a response after 1.5 second.
This example shows that you need a promise,
if your response needs time to created.
The <code>ReactPHP Promise</code> will resolve in a <code>Response</code> object when the request
body ends.
If the client closes the connection while the promise is still pending, the
promise will automatically be cancelled.
The promise cancellation handler can be used to clean up any pending resources
allocated in this case (if applicable).
If a promise is resolved after the client closes, it will simply be ignored.</p>
<p>The <code>Response</code> class in this project supports to add an instance which implements the
<a href="https://github.com/reactphp/stream#readablestreaminterface">ReactPHP ReadableStreamInterface</a>
for the response body.
So you are able stream data directly into the response body.
Note that other implementations of the <code>PSR-7 ResponseInterface</code> likely
only support strings.</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>) {</span>
<span class="pl-s1">    <span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ThroughStream</span>();</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$timer</span> <span class="pl-k">=</span> <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addPeriodicTimer(<span class="pl-c1">0.5</span>, <span class="pl-k">function</span> () <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>emit(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, <span class="pl-c1">array</span>(<span class="pl-c1">microtime</span>(<span class="pl-c1">true</span>) <span class="pl-k">.</span> <span class="pl-c1">PHP_EOL</span>));</span>
<span class="pl-s1">    });</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>addTimer(<span class="pl-c1">5</span>, <span class="pl-k">function</span>() <span class="pl-k">use</span> (<span class="pl-smi">$loop</span>, <span class="pl-smi">$timer</span>, <span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">        <span class="pl-smi">$loop</span><span class="pl-k">-&gt;</span>cancelTimer(<span class="pl-smi">$timer</span>);</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span><span class="pl-k">-&gt;</span>emit(<span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    });</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>), <span class="pl-smi">$stream</span>);</span>
<span class="pl-s1">});</span></pre></div>
<p>The above example will emit every 0.5 seconds the current Unix timestamp
with microseconds as float to the client and will end after 5 seconds.
This is just a example you could use of the streaming,
you could also send a big amount of data via little chunks
or use it for body data that needs to calculated.</p>
<p>If the request handler resolves with a response stream that is already closed,
it will simply send an empty response body.
If the client closes the connection while the stream is still open, the
response stream will automatically be closed.
If a promise is resolved with a streaming body after the client closes, the
response stream will automatically be closed.
The <code>close</code> event can be used to clean up any pending resources allocated
in this case (if applicable).</p>
<p>If the response body is a <code>string</code>, a <code>Content-Length</code> header will be added
automatically.
If the response body is a ReactPHP <code>ReadableStreamInterface</code> and you do not
specify a <code>Content-Length</code> header, HTTP/1.1 responses will automatically use
chunked transfer encoding and send the respective header
(<code>Transfer-Encoding: chunked</code>) automatically.
The server is responsible for handling <code>Transfer-Encoding</code>, so you SHOULD NOT
pass this header yourself.
If you know the length of your stream body, you MAY specify it like this instead:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$stream</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">ThroughStream</span>()</span>
<span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) <span class="pl-k">use</span> (<span class="pl-smi">$stream</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(</span>
<span class="pl-s1">        <span class="pl-c1">200</span>,</span>
<span class="pl-s1">        <span class="pl-c1">array</span>(</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Length<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>5<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">            <span class="pl-s"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>text/plain<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        ),</span>
<span class="pl-s1">        <span class="pl-smi">$stream</span></span>
<span class="pl-s1">    );</span>
<span class="pl-s1">});</span></pre></div>
<p>An invalid return value or an unhandled <code>Exception</code> in the code of the callback
function, will result in an <code>500 Internal Server Error</code> message.
Make sure to catch <code>Exceptions</code> to create own response messages.</p>
<p>After the return in the callback function the response will be processed by the <code>Server</code>.
The <code>Server</code> will add the protocol version of the request, so you don't have to.</p>
<p>Any response to a <code>HEAD</code> request and any response with a <code>1xx</code> (Informational),
<code>204</code> (No Content) or <code>304</code> (Not Modified) status code will <em>not</em> include a
message body as per the HTTP specs.
This means that your callback does not have to take special care of this and any
response body will simply be ignored.</p>
<p>Similarly, any <code>2xx</code> (Successful) response to a <code>CONNECT</code> request, any response
with a <code>1xx</code> (Informational) or <code>204</code> (No Content) status code will <em>not</em>
include a <code>Content-Length</code> or <code>Transfer-Encoding</code> header as these do not apply
to these messages.
Note that a response to a <code>HEAD</code> request and any response with a <code>304</code> (Not
Modified) status code MAY include these headers even though
the message does not contain a response body, because these header would apply
to the message if the same request would have used an (unconditional) <code>GET</code>.</p>
<blockquote>
<p>Note that special care has to be taken if you use a body stream instance that
implements ReactPHP's
<a href="https://github.com/reactphp/stream#duplexstreaminterface"><code>DuplexStreamInterface</code></a>
(such as the <code>ThroughStream</code> in the above example).</p>
<p>For <em>most</em> cases, this will simply only consume its readable side and forward
(send) any data that is emitted by the stream, thus entirely ignoring the
writable side of the stream.
If however this is either a <code>101</code> (Switching Protocols) response or a <code>2xx</code>
(Successful) response to a <code>CONNECT</code> method, it will also <em>write</em> data to the
writable side of the stream.
This can be avoided by either rejecting all requests with the <code>CONNECT</code>
method (which is what most <em>normal</em> origin HTTP servers would likely do) or
or ensuring that only ever an instance of <code>ReadableStreamInterface</code> is
used.</p>
<p>The <code>101</code> (Switching Protocols) response code is useful for the more advanced
<code>Upgrade</code> requests, such as upgrading to the WebSocket protocol or
implementing custom protocol logic that is out of scope of the HTTP specs and
this HTTP library.
If you want to handle the <code>Upgrade: WebSocket</code> header, you will likely want
to look into using <a href="http://socketo.me/">Ratchet</a> instead.
If you want to handle a custom protocol, you will likely want to look into the
<a href="https://tools.ietf.org/html/rfc7230#section-6.7">HTTP specs</a> and also see
<a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">examples #31 and #32</a> for more details.
In particular, the <code>101</code> (Switching Protocols) response code MUST NOT be used
unless you send an <code>Upgrade</code> response header value that is also present in
the corresponding HTTP/1.1 <code>Upgrade</code> request header value.
The server automatically takes care of sending a <code>Connection: upgrade</code>
header value in this case, so you don't have to.</p>
<p>The <code>CONNECT</code> method is useful in a tunneling setup (HTTPS proxy) and not
something most origin HTTP servers would want to care about.
The HTTP specs define an opaque "tunneling mode" for this method and make no
use of the message body.
For consistency reasons, this library uses a <code>DuplexStreamInterface</code> in the
response body for tunneled application data.
This implies that that a <code>2xx</code> (Successful) response to a <code>CONNECT</code> request
can in fact use a streaming response body for the tunneled application data,
so that any raw data the client sends over the connection will be piped
through the writable stream for consumption.
Note that while the HTTP specs make no use of the request body for <code>CONNECT</code>
requests, one may still be present. Normal request body processing applies
here and the connection will only turn to "tunneling mode" after the request
body has been processed (which should be empty in most cases).
See also <a href="https:/github.com/reactphp/http/blob/0be1fc8b03d3305e18950071a088b55c4418f4df
/examples">example #22</a> for more details.</p>
</blockquote>
<p>A <code>Date</code> header will be automatically added with the system date and time if none is given.
You can add a custom <code>Date</code> header yourself like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Date<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-c1">date</span>(<span class="pl-s"><span class="pl-pds">'</span>D, d M Y H:i:s T<span class="pl-pds">'</span></span>)));</span>
<span class="pl-s1">});</span></pre></div>
<p>If you don't have a appropriate clock to rely on, you should
unset this header with an empty string:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>Date<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>));</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that it will automatically assume a <code>X-Powered-By: react/alpha</code> header
unless your specify a custom <code>X-Powered-By</code> header yourself:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>X-Powered-By<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span>PHP 3<span class="pl-pds">'</span></span>));</span>
<span class="pl-s1">});</span></pre></div>
<p>If you do not want to send this header at all, you can use an empty string as
value like this:</p>
<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-smi">$server</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Server</span>(<span class="pl-k">function</span> (<span class="pl-c1">ServerRequestInterface</span> <span class="pl-smi">$request</span>) {</span>
<span class="pl-s1">    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-c1">Response</span>(<span class="pl-c1">200</span>, <span class="pl-c1">array</span>(<span class="pl-s"><span class="pl-pds">'</span>X-Powered-By<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>));</span>
<span class="pl-s1">});</span></pre></div>
<p>Note that persistent connections (<code>Connection: keep-alive</code>) are currently
not supported.
As such, HTTP/1.1 response messages will automatically include a
<code>Connection: close</code> header, irrespective of what header values are
passed explicitly.</p>
<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h2>
<p>The recommended way to install this library is <a href="http://getcomposer.org">through Composer</a>.
<a href="http://getcomposer.org/doc/00-intro.md">New to Composer?</a></p>
<p>This will install the latest supported version:</p>
<div class="highlight highlight-source-shell"><pre>$ composer require react/http:^0.7.1</pre></div>
<p>More details about version upgrades can be found in the <a href="changelog.html">CHANGELOG</a>.</p>
<h2>
<a id="tests" class="anchor" href="#tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tests</h2>
<p>To run the test suite, you first need to clone this repo and then install all
dependencies <a href="http://getcomposer.org">through Composer</a>:</p>
<div class="highlight highlight-source-shell"><pre>$ composer install</pre></div>
<p>To run the test suite, go to the project root and run:</p>
<div class="highlight highlight-source-shell"><pre>$ php vendor/bin/phpunit</pre></div>
<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>
<p>MIT, see <a href="license.html">LICENSE file</a>.</p>
            </main>
            <aside class="sidebar" role="complementary">
                <section class="component-info">
                    <h2 class="component-info__title">
                        <a href="../../http/v0.7.1/">HTTP</a>

                        <div class="version-selector">
                            <button class="version-selector__button" aria-expanded="false" aria-controls="component-version-selector" data-version-selector-toggle>
                                v0.7.1

                                <i class="icon-chevron-down" aria-hidden="true"></i>
                                <i class="icon-chevron-up" aria-hidden="true"></i>
                            </button>

                            <div id="component-version-selector" class="version-selector__panel" aria-hidden="true">
                                <ul class="version-selector__list">
                                                                    <li>
                                        <a href="../../http/v0.7.4/" class="version-selector__version version-selector__version--latest">
                                            v0.7.4
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.7.3/" class="version-selector__version">
                                            v0.7.3
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.7.2/" class="version-selector__version">
                                            v0.7.2
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.7.1/" class="version-selector__version">
                                            v0.7.1
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.7.0/" class="version-selector__version">
                                            v0.7.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.6.0/" class="version-selector__version">
                                            v0.6.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.5.0/" class="version-selector__version">
                                            v0.5.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.4.4/" class="version-selector__version">
                                            v0.4.4
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.4.3/" class="version-selector__version">
                                            v0.4.3
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.4.2/" class="version-selector__version">
                                            v0.4.2
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.4.1/" class="version-selector__version">
                                            v0.4.1
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.4.0/" class="version-selector__version">
                                            v0.4.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.3.0/" class="version-selector__version">
                                            v0.3.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.2.6/" class="version-selector__version">
                                            v0.2.6
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.2.3/" class="version-selector__version">
                                            v0.2.3
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.2.2/" class="version-selector__version">
                                            v0.2.2
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.2.1/" class="version-selector__version">
                                            v0.2.1
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.2.0/" class="version-selector__version">
                                            v0.2.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.1.1/" class="version-selector__version">
                                            v0.1.1
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/v0.1.0/" class="version-selector__version">
                                            v0.1.0
                                        </a>
                                    </li>
                                                                    <li>
                                        <a href="../../http/master/" class="version-selector__version version-selector__version--dev">
                                            master
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </h2>

                    <ul class="component-info__info">
                        <li>
                            <a href="https://github.com/reactphp/http">
                                <i class="icon-github" aria-hidden="true"></i> reactphp/http
                            </a>
                        </li>
                        <li>
                            <a href="../../http/license.html">
                                <i class="icon-law" aria-hidden="true"></i> MIT License
                            </a>
                        </li>
                    </ul>

                    <h3 class="component-info__subtitle">Installation</h3>

                    <div class="highlight highlight-source-shell"><pre>composer require react/http:^0.7.1</pre></div>

                    <h3 class="component-info__subtitle">Contributors</h3>

                    <ul class="component-info__contributors">
                                            <li>
                            <a href="https://github.com/clue">
                                <img src="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=40" srcset="https://avatars1.githubusercontent.com/u/776829?v=4&amp;s=80 2x" alt="clue" title="clue (117 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/WyriHaximus">
                                <img src="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/147145?v=4&amp;s=80 2x" alt="WyriHaximus" title="WyriHaximus (94 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/legionth">
                                <img src="https://avatars0.githubusercontent.com/u/1578709?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/1578709?v=4&amp;s=80 2x" alt="legionth" title="legionth (43 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/igorw">
                                <img src="https://avatars2.githubusercontent.com/u/88061?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/88061?v=4&amp;s=80 2x" alt="igorw" title="igorw (40 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/cboden">
                                <img src="https://avatars0.githubusercontent.com/u/617694?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/617694?v=4&amp;s=80 2x" alt="cboden" title="cboden (30 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/arnaud-lb">
                                <img src="https://avatars3.githubusercontent.com/u/365207?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/365207?v=4&amp;s=80 2x" alt="arnaud-lb" title="arnaud-lb (23 contributions)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/jsor">
                                <img src="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/55574?v=4&amp;s=80 2x" alt="jsor" title="jsor (8 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/onigoetz">
                                <img src="https://avatars0.githubusercontent.com/u/309594?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/309594?v=4&amp;s=80 2x" alt="onigoetz" title="onigoetz (6 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/andig">
                                <img src="https://avatars1.githubusercontent.com/u/184815?v=4&amp;s=40" srcset="https://avatars1.githubusercontent.com/u/184815?v=4&amp;s=80 2x" alt="andig" title="andig (5 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/nopolabs">
                                <img src="https://avatars2.githubusercontent.com/u/815864?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/815864?v=4&amp;s=80 2x" alt="nopolabs" title="nopolabs (3 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/slava-vishnyakov">
                                <img src="https://avatars0.githubusercontent.com/u/817931?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/817931?v=4&amp;s=80 2x" alt="slava-vishnyakov" title="slava-vishnyakov (3 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/aaronbonneau">
                                <img src="https://avatars0.githubusercontent.com/u/8574061?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/8574061?v=4&amp;s=80 2x" alt="aaronbonneau" title="aaronbonneau (2 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/iannsp">
                                <img src="https://avatars2.githubusercontent.com/u/40551?v=4&amp;s=40" srcset="https://avatars2.githubusercontent.com/u/40551?v=4&amp;s=80 2x" alt="iannsp" title="iannsp (2 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/beaucollins">
                                <img src="https://avatars0.githubusercontent.com/u/19795?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/19795?v=4&amp;s=80 2x" alt="beaucollins" title="beaucollins (1 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/greevex">
                                <img src="https://avatars3.githubusercontent.com/u/148401?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/148401?v=4&amp;s=80 2x" alt="greevex" title="greevex (1 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/marenzo">
                                <img src="https://avatars3.githubusercontent.com/u/1208453?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/1208453?v=4&amp;s=80 2x" alt="marenzo" title="marenzo (1 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/ojhaujjwal">
                                <img src="https://avatars3.githubusercontent.com/u/4995501?v=4&amp;s=40" srcset="https://avatars3.githubusercontent.com/u/4995501?v=4&amp;s=80 2x" alt="ojhaujjwal" title="ojhaujjwal (1 contribution)">
                            </a>
                        </li>
                                            <li>
                            <a href="https://github.com/e3betht">
                                <img src="https://avatars0.githubusercontent.com/u/1811561?v=4&amp;s=40" srcset="https://avatars0.githubusercontent.com/u/1811561?v=4&amp;s=80 2x" alt="e3betht" title="e3betht (1 contribution)">
                            </a>
                        </li>
                                        </ul>

                    <h3 class="component-info__subtitle">Activity</h3>

                    <div class="component-info__participation">
                        <svg width="320" height="42">
    <defs>
        <linearGradient id="reactphp-http-participation-gradient" x1="0" x2="0" y1="1" y2="0">
            <stop offset="10%" stop-color="#40a977"></stop>
            <stop offset="90%" stop-color="#ba3525"></stop>
        </linearGradient>
        <mask id="reactphp-http-participation-sparkline" x="0" y="0" width="320" height="40" >
            <polyline 
                transform="translate(0, 40) scale(1,-1)"
                points="0,1 6,2 12,1 18,1 24,1 30,3 36,1 42,1 48,2 54,1 60,2 66,1 72,1 78,1 84,1 90,1 96,1 102,1 108,41 114,29 120,22 126,16 132,15 138,3 144,8 150,15 156,11 162,3 168,14 174,7 180,4 186,5 192,5 198,13 204,6 210,3 216,6 222,2 228,3 234,5 240,6 246,2 252,2 258,4 264,2 270,5 276,1 282,1 288,5 294,6 300,5 306,2" 
                fill="transparent" 
                stroke="#40a977" 
                stroke-width="2"
            >
        </mask>
    </defs>

    <g transform="translate(0, -1.5)">
        <rect 
            x="0" 
            y="-2" 
            width="320" 
            height="42"
            style="stroke:none;fill:url(#reactphp-http-participation-gradient);mask:url(#reactphp-http-participation-sparkline)"
        ></rect>
    </g>
</svg>
                    </div>
                </section>
            </aside>
        </div>
    </div>

            <footer class="footer">
            <div class="wrapper">
                <ul class="links">
                    <li><a href="https://github.com/reactphp"><i class="icon-github" aria-hidden="true"></i> GitHub</a></li>
                    <li><a href="https://twitter.com/reactphp"><i class="icon-twitter" aria-hidden="true"></i> Twitter</a></li>
                    <li><a href="irc://irc.freenode.net/reactphp"><i class="icon-hash" aria-hidden="true"></i> IRC</a></li>
                </ul>
            </div>
        </footer>
    
    <script async src="../../assets/main.89f52cb36b2ecce568ca.js"></script>
    </body>
</html>
